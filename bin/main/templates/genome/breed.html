<!doctype html>
<html lang="en" dir="ltr" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security" th:with="user = ${#authentication.principal}">
<head>
    <!-- 공통 헤더 -->
    <th:block th:include="/../fragments/header.html"></th:block>
    <style>
        .card {
            box-shadow: 0 3px 20px 3px rgb(0 0 0 / 7%);
        }

        table {
            border-top: 1px solid grey;
            border-collapse: collapse;
        }

        th, td {
            border-bottom: 2px solid #E5E9F2;
            padding: 10px;
            text-align: center;
            font-weight: initial;
        }

        th, tbody tr {
            background-color: white;
        }

        .main-content .card-extra .justify-content-end .atbd-button-list {
            width: auto;
            margin: 0;
        }

        .main-content .nav-tabs .nav-link.active, .main-content .nav-tabs .nav-item.show .nav-link, .modal-basic .atbd-tab .nav-link {
            color: #D9D9D9;
            font-size: 16px;
            font-weight: 700;
        }

        .main-content .atbd-tab .nav-link:after {
            background-color: #f4f5f7;
        }

        .modal-basic .atbd-tab .nav-tabs .nav-item.active a {
            border-radius: 21px;
            background-color: #EDF6F1;
            color: #217566;
            font-size: 16px;
            font-weight: 700;
        }

        .modal-basic .atbd-tab .nav-tabs .nav-item a::after,
        .modal-basic .atbd-tab .nav-tabs:after {
            display: none;
        }

        .content_title {
            width: 100%;
            background-color: #F7F7F8;
            padding: 10px 0;
        }

        .content_title li {
            float: left;
            width: 50%;
            text-align: center;
        }

        .content_1 {
            max-height: 500px;
            overflow: auto;
            line-height: 2;
        }

        #grid .content_1, #grid3 .content_1 {
            padding-top: 20px;
        }

        .content_1 .title {
            float: left;
        }

        .content_1 .input_text {
            float: right;
            width: 30%;
        }

        .content_1 .input_text input[type="text"] {
            width: 180%;
        }

        #grid .content_1 li, #grid3 .content_1 li {
            display: inline-block;
            width: 80%;
            color: #222222;
            font-size: 16px;
        }

        .pop1 .modal-dialog textarea {
            width: 100%;
            height: 150px;
            border-radius: 5px;
            border: 1px solid #D9D9D9;
            margin-top: 20px;
        }

        .pop1 .modal-dialog .btn-upload {
            width: 100%;
        }

        .pop1 .atbd-upload__file {
            display: none;
        }

        .pop2 .modal-header {
            display: -webkit-box;
        }

        .main-content .pop1 .form-group input[type=text] {
            flex: 0 0 85%;
        }

        .main-content .pop1 .form-group span {
            flex: 0 0 10%;
        }

        .main-content .pop1 a.btn-outline-lighten {
            display: block;
            text-align: left;
            color: #B2B2B2;
        }

        #gen-messege {
            display: table;
        }

        #gen-messege .modal-dialog {
            display: table-cell;
            vertical-align: middle;
        }

        #gen-messege .modal-dialog .modal-content {
            max-width: 700px;
            margin: 0 auto;
            text-align: center;
            padding: 40px 0;
        }

        #gen-messege .modal-dialog .modal-content .messege {
            padding-bottom: 30px;
        }

        @media (min-width: 576px) {
            .modal-dialog {
                max-width: 1014px;
                margin: 1.75rem auto;
            }

            .pop1 .modal-dialog {
                max-width: 750px;
            }

            .pop4 .modal-dialog {
                max-width: 750px;
                margin: 0 auto;
            }
        }

        .btn.btn-light.btn-transparent-light {
            display: block;
            width: 100%;
            background-color: rgba(244, 245, 247, 0);
        }

        .main-content .contents .container-fluid {
            max-width: 100%;
            padding: 50px;
        }

        .bg-white > .row {
            padding-top: 50px;
        }

        .top-menu .type_1 {
            background-color: #768BF5;
            border-left: none;
            border-radius: 0 5px 5px 0;
        }

        #searchResearch {
            float: left;
            width: 60%;
            border-radius: 5px 0 0 0;
            border-right: none;
            height: 42px;
        }

        #addResearchBtn {
            float: left;
            border-left: none;
            border-radius: 0 5px 0 0;
            height: 42px;
            margin-top: 0 !important;
            width: 40%;
        }

        .box_content {
            -webkit-box-flex: 0;
            -ms-flex: 0 0 66.66667%;
            flex: 0 0 10%;
            max-width: 10%;
            display: flex;
            justify-content: center;
        }

        .box_center li {
            margin-bottom: 20px;
        }


        /* alpa 수정 2021-11-05 */
        .box_center .buttonLi button {
            width: 28px;
            height: 28px;
            border: 2px solid #217566;
            background-color: transparent;
            border-radius: 50%;
        }

        .box_center .buttonLi button svg {
            display: none;
        }

        .box_center .buttonLi button span {
            position: relative;
        }

        .box_center .buttonLi button span::before {
            content: "";
            display: block;
            position: absolute;
            top: -1px;
            left: 0;
            width: 2px;
            height: 8px;
            background-color: #217566;
            transform: rotate(45deg);
        }

        .box_center .buttonLi button span::after {
            content: "";
            display: block;
            position: absolute;
            top: -6px;
            left: 0;
            width: 2px;
            height: 8px;
            background-color: #217566;
            transform: rotate(-45deg);
        }

        .box_center .buttonLi button span.left_btn::before {
            left: -2px;
            transform: rotate(-45deg);
        }

        .box_center .buttonLi button span.left_btn::after {
            left: -2px;
            transform: rotate(45deg);
        }

        #grid2 .tab-content .row .detail_list li {
            width: 100%;
            border-bottom: 1px solid #E2E3E5;
        }

        #grid2 .tab-content .row .detail_list li.checked {
            color: #fff;
            background-color: #217566;
        }

        #grid2 .tab-content .row .list-group {
            width: 100%;
            font-size: 14px;
            margin: 0 !important;
        }

        #grid2 .tab-content .row .detail_list li:hover,
        #grid2 .tab-content .row .display_list li:hover {
            background-color: #EDF6F1;
        }

        #grid2 .tab-content .row .detail_list li.active,
        #grid2 .tab-content .row .display_list li.active {
            background-color: #217566;
            color: #fff;
            border: none;
        }

        #grid2 .tab-content .row .display_list li .row {
            margin-left: 0;
            margin-right: 0;
            display: block;
        }

        #grid2 input[type="checkbox"] {
            display: none !important;
        }

        #grid2 .tab-content .row li {
            padding: 0 10px !important;
        }

        /* 2021-11-05 */
        .card-body .mt-4 {
            margin-top: 10px !important;
        }

        @media (min-width: 992px) {
            .card .col-lg-8 {
                -webkit-box-flex: 0;
                -ms-flex: 0 0 66.66667%;
                flex: 0 0 70%;
                max-width: 70%;
            }

            .card .col-lg-3 {
                -webkit-box-flex: 0;
                -ms-flex: 0 0 25%;
                flex: 0 0 25%;
                max-width: 25%;
            }
        }

        #grid2 .contents .row {
            align-items: center;
        }

        #grid2 .content_1 .row.mt-20 {
            margin-top: 0 !important;
        }

        #grid2 .content_1 li {
            cursor: pointer;
        }

        #grid2 .content_1 li div.title {
            display: inline-block;
            float: none;
        }

        #grid2 .content_1 li input[type="checkbox"] {
            margin: 0 10px;
            display: inline-block;
        }

        #grid2 .content_1 .list-group {
            min-width: max-content;
        }

        #data_upload .modal-body .form-group {
            justify-content: flex-start;
        }

        #data_upload .form-group button, #data_upload2 .form-group button, #breed_file .form-group button {
            height: 45px;
            padding: 0 20px;
            background-color: #217566;
            color: #fff;
            border: none;
            border-radius: 5px;
            margin-left: 10px;
        }

        #data_upload2 .form-group button, #breed_file .form-group button {
            margin-left: 0;
        }

        #data_upload .form-group input[type=text], #data_upload2 .form-group input[type=text], #breed_file .form-group input[type=text] {
            flex: 0 0 30%;
            cursor: pointer;
        }

        #data_upload .form-group input[type=text]::-webkit-input-placeholder {
            background: url("../assets/vendor_assets/img/upload.png") no-repeat 0 3px;
            background-size: 15px;
            color: #B2B2B2;
        }

        #data_upload .atbd-upload, #data_upload2 .atbd-upload {
            width: 100%;
            min-height: 600px;
            overflow: auto;
        }

        #data_upload .atbd-upload table {
            min-width: max-content;
            border: none;
        }

        #data_upload2 .atbd-upload table {
            width: 100%;
        }

        #data_upload table thead tr, #data_upload2 table thead tr {
            border-top: none;
            border-bottom: 2px solid #E8EEF2;
        }

        #data_upload table tbody tr, #data_upload2 table tbody tr {
            border-bottom: 1px solid #E8EEF2;
        }

        #data_upload .atbd-upload table thead th, #data_upload2 .atbd-upload table thead th {
            background-color: #F7F7F8;
            color: #222222;
            font-size: 16px;
        }

        #data_upload .atbd-upload table tbody td, #data_upload2 .atbd-upload table tbody td {
            background-color: #fff;
            color: #666666;
            font-size: 16px;
            font-weight: 200;
        }

        /* 2021 - 11 - 01 수정 */
        #breed_list td {
            padding: 0px 12px;
            vertical-align: middle;
            font-size: 14px
        }

        #breed_list th {
            font-size: 16px
        }

        .table td {
            padding: 0px 12px;
            vertical-align: middle;
            font-size: 14px;
            border-bottom: 2px solid #d9d9d9;
        }

        /* 2021 - 11 - 02 수정 */
        .table th {
            font-size: 16px;
            border-top: 1px solid #d9d9d9;
        }

        /* 2021 - 11 - 02 수정 */
        .table thead th {
            border-bottom: 2px solid #adadad;
        }

        /* 2021 - 11 - 02 수정 */

        .main-content .table thead th span.title:before,
        .main-content .table thead th span.title:after,
        .main-content .table thead th i {
            display: none;
        }

        .main-content .table thead th > img {
            margin: 6px 0 0 12px;
        }

        /* 팝업 */
        .popup_wrap {
            display: none
        }

        .popup_wrap.on {
            display: block;
            position: fixed;
            left: 0;
            top: 0;
            right: 0;
            bottom: 0;
            z-index: 999;
            background-color: rgba(0, 0, 0, 0.1);
        }

        .popup_wrap.on .popup {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 400px;
            height: 150px;
            background-color: #fff;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            padding-top: 40px
        }

        .popup_wrap.on .close {
            opacity: 1;
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            bottom: 20px;
            font-size: 14px;
            background-color: #1e695c;
            display: block;
            height: 35px;
            width: 90px;
            color: #fff;
            font-weight: 400;
            border-radius: 6px
        }

        /* 2021 - 11 - 02 수정 */
        #data_upload .form-group button {
            line-height: 2rem;
            font-size: 13px;
            height: 34px;
            margin-left: 5px;
        }

        #data_upload .form-group input[type=text] {
            height: 34px;
        }

        #data_upload .form-group input[type=text]::placeholder {
            text-align: left;
            text-indent: 20px;
            font-size: 14px;
        }


        .contents .container-fluid {
            background-color: #FCFCFC;
        }

        .atbd-upload > table {
            width: 100%;
        }

        .modal-content .modal-footer {
            padding-bottom: 28px;
            padding-right: 24px;
        }

        .btn-primary {
            border: none;
        }


        .box_center li button {
            padding: 2px 5px;
        }

        .top-menu .box_center li button > .feather {
            margin-right: 1px;
            margin-bottom: 4px;
        }

        .main-content .card-extra .justify-content-end .atbd-button-list .data_btn1,
        .main-content .card-extra .justify-content-end .atbd-button-list .data_btn2,
        .main-content .card-extra .justify-content-end .atbd-button-list .form-control {
            height: 36px;
        }

        .main-content .card-extra .justify-content-end .atbd-button-list .data_btn1,
        .main-content .card-extra .justify-content-end .atbd-button-list .data_btn2 {
            width: 31px;
        }

        .btn-lg, .btn-group-lg > .btn {
            padding: 0px 19px;
        }

        .atbd-button-list button {
            margin: 5px 3px;
        }

        #data_upload2 .form-group button, #breed_file .form-group button {
            height: 34px;
            line-height: 2rem;
            font-size: 13px;
        }

        input[type="text"].updateInput {
            border: none;
            height: 45px;
            text-align: center;
        }

        #pop_data1 .modal-body li a {
            display: block;
            width: 120px;
            padding: 15px 0;
            text-align: center;
            margin: 0;
            font-size: 14px;
            background-color: #FBFBFB;
            border-radius: 0 5px 5px 0;
        }

        #pop_data1 .modal-body .btn-group > ul > li:first-child a {
            border-radius: 5px 0 0 5px;
        }

        #pop_data1 .modal-body .btn-group > ul > li a.active, #pop_data1 .btn-group > ul > li:hover a {
            border-color: #C3E3CC;
            background-color: #EDF6F1 !important;
            color: #217566;
        }

        #pop_data .atbd-button-group li.active {
            background-color: #EDF6F1 !important;
        }

        .btn:not(:disabled):not(.disabled):active, .btn:not(:disabled):not(.disabled).active {
            -webkit-box-shadow: none;
            box-shadow: none;
        }

        .popAdd.active {
            display: block;
        }

        .popAdd {
            display: none;
        }

        /* 푸터 배경색 */
        .footer-wrapper {
            background-color: #FCFCFC;
        }

        #breedGrid .tui-grid-body-area td[data-column-name='status'], #breedGrid .tui-grid-body-area td[data-column-name='file'],
        #breedGrid .tui-grid-body-area td[data-column-name*='img'], #breedGrid .tui-grid-body-area td[data-column-name*='doc'] {
            cursor: pointer;
        }

		/*

        #breedGrid .tui-grid-body-area td[] {
            cursor: pointer;
        }
        
        */

        #saveRow, #updateRow {
            float: right;
            color: #fff;
            background-color: #217566;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
        }

        #cancelRow, #cancelUpdate {
            float: right;
            color: #217566;
            background-color: #fff;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
        }

        .pop_cover_inner {
            padding-top: 30px;
        }


        table {
            border-collapse: collapse;
            border-spacing: 0;
        }

        #pop_data1 table thead tr {
            border-top: 2px solid #aaa;
            border-bottom: 2px solid #aaa;
        }

        #pop_data1 table thead th {
            border-left: 1px solid #eee;
            border-right: 1px solid #eee;
            color: #222;
            font-size: 13px;
        }

        #pop_data1 table thead th:first-child {
            border-left: none;
        }

        #pop_data1 table thead th:last-child {
            border-right: none;
        }

        #pop_data1 table tbody tr {
            border-bottom: 1px solid #eee;
        }

        #pop_data1 table tbody td {
            background-color: #fff;
            color: #333;
            font-size: 13px;
        }

        .plus_btn_submit1 {
            display: none;
        }

        .plus_btn_submit2 {
            display: none;
        }

        .modal-dialog {
            height: 90vh;
        }

        .modal-content {
            height: 100%;
        }

        .modal-body {
            width: 100%;
            height: 100%;
            overflow: hidden;
        }


        #excelForm {
            overflow-y: scroll;
        }

        #excel_data {
            min-width: 100%;
            width: max-content;
        }

        #excel_data th {
            min-width: 54px;
        }

        #excel_data th, #excel_data td {
            font-size: 12px;
        }

        .tui-grid-cell {
            background-color: white;
        }

        #file_grid {
            width: 100%;
            height: 600px;
            overflow: scroll;
        }

        #file_modal {
            height: 655px;
        }

        [id*="grid"] .color-dark.align-center {
            font-size: 16px !important;
        }

        .load_wrap {
            display: none;
        }

        .load_wrap.on {
            display: flex;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 9999999999;
            background-color: rgba(0, 0, 0, 0.3);
            justify-content: center;
            align-items: center;
        }

        .load_wrap .load {
            background-color: #fff;
            width: 220px;
            height: 90px;
            text-align: center;
            padding: 15px;
            border-radius: 6px;
        }

        .load_wrap .load > h2 {
            font-size: 17px;
            font-weight: bold;
            color: #666;
        }

        .loader,
        .loader:before,
        .loader:after {
            border-radius: 50%;
            width: 1.3em;
            height: 1.3em;
            -webkit-animation-fill-mode: both;
            animation-fill-mode: both;
            -webkit-animation: load7 1.8s infinite ease-in-out;
            animation: load7 1.8s infinite ease-in-out;
        }

        .loader {
            color: #397FF4;
            font-size: 10px;
            margin: -10px auto 0;
            position: relative;
            text-indent: -9999em;
            -webkit-transform: translateZ(0);
            -ms-transform: translateZ(0);
            transform: translateZ(0);
            -webkit-animation-delay: -0.16s;
            animation-delay: -0.16s;
        }

        .loader:before,
        .loader:after {
            content: '';
            position: absolute;
            top: 0;
        }

        .loader:before {
            left: -2.2em;
            -webkit-animation-delay: -0.32s;
            animation-delay: -0.32s;
        }

        .loader:after {
            left: 2.2em;
        }

        @-webkit-keyframes load7 {
            0%,
            80%,
            100% {
                box-shadow: 0 2.5em 0 -1.3em;
            }
            40% {
                box-shadow: 0 2.5em 0 0;
            }
        }

        @keyframes load7 {
            0%,
            80%,
            100% {
                box-shadow: 0 2.5em 0 -1.3em;
            }
            40% {
                box-shadow: 0 2.5em 0 0;
            }
        }

        /* 여기서부터 */
        .main-content .form-group:nth-child(2) {
            display: block;
            width: 100%;
        }

        .image-container {
            width: 300px;
            height: 200px;
            margin: 0 auto;
        }

        .image-container img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        /* tui 최신화하면서 cell 왼쪽정렬이 기본값이 되어버린듯. 중앙정렬로 수정 */
        .main-content {
		    text-align: center !important;
		}
    </style>
</head>
<body class="layout-light top-menu overlayScroll">
<div class="mobile-search"></div>
<div class="mobile-author-actions"></div>

<!-- 공통 topbar -->
<th:block th:include="/../fragments/topbar.html"></th:block>
<main class="main-content" style="background-color: #FCFCFC;">
    <div class="contents" style="background-color: #FFFFFF;">
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-12 mb-30">
                    <div class="card">
                        <div class="card-extra mt-20 mr-20">
                            <div class="breadcrumb-main" style="float: left;">
                                <h4 class="text-capitalize breadcrumb-title manage" id="title" th:text="${type}"></h4>
                                <input type="hidden" id="user_type" th:value="${user.user_type}">
                                <input type="hidden" id="user_group" th:value="${user.user_group}">
                            </div>
                            <div class="action-btn d-flex justify-content-end">
                                <div class="atbd-button-list d-flex flex-wrap">
                                    <select class="form-control form-control-lg mt-10 mb-10 mr-10" style="width: 250px; float: left;" id="limit">
                                        <option value="10">10개</option>
                                        <option value="20">20개</option>
                                        <option value="30">30개</option>
                                    </select>
                                    <select class="form-control form-control-lg mt-10 mb-10 mr-10" style="width: 250px;" name="selectCrop" id="CropSelect"
                                            onChange="changeSelect(this)">
                                        <th:block th:each="list : ${cropList}">
                                            <option th:if="${crop_id != list.crop_id}" th:value="${list.crop_id}" th:text="${list.crop_name}"></option>
                                            <option th:if="${crop_id == list.crop_id}" th:value="${list.crop_id}" th:text="${list.crop_name}" selected></option>
                                        </th:block>
                                    </select>
                                    <button class="btn btn-lg btn-primary data_btn2" title="데이터 등록" onclick="openExcel()">
                                        <img src="../assets/vendor_assets/img/icon1.png" alt="">
                                    </button>
                                    <button class="btn btn-lg btn-primary data_btn2" title="표시항목 선택" onclick="DisplayBtn();">
                                        <img src="../assets/vendor_assets/img/icon3.png" alt="">
                                    </button>
                                </div>
                            </div>
                        </div>
                        <input type="hidden" id="resource_id" th:value="${resource_id}">
                        <input type="hidden" id="resource_name" th:value="${type}">
                        <div class='card-extra mt-10 mb-10 mr-20 plus_btn_submit1'>
                            <button type='button' id="cancelRow" onclick="cancelRow()">취소</button>
                            <button type='button' id="saveRow" onclick="saveRow()">저장</button>
                        </div>
                        <div class='card-extra mt-10 mb-10 mr-20 plus_btn_submit2'>
                            <button type='button' id="cancelUpdate" onclick="cancelUpdate()">취소</button>
                            <button type='button' id="updateRow" onclick="updateRow()">수정</button>
                        </div>
                        <div class="card-body" style="padding-top: 0">
                            <div class="bg-white">
                                <div id="breedGrid"></div>
                                <div class="row" style="padding-top: 0;">
                                    <div class="col-4">
                                        <button class="btn btn-icon btn-light btn-circle" onclick="insertRow();">
                                            <span data-feather="plus"></span>
                                        </button>
                                        <button class="btn btn-icon btn-light btn-circle" onclick="DeleteBreed();">
                                            <span data-feather="trash-2"></span>
                                        </button>
                                        <button class="btn btn-icon btn-light btn-circle" id="data_check_submit" onclick="AnalysisBtn();" style="width:44.03px; height:42px;">
                                            <img src="../assets/vendor_assets/img/check_tab.png" alt="check" style="width: 17px;margin-left: 4px;">
                                        </button>
                                        <input type="hidden" id="offset">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 첨부파일 목록창 -->
    <div class="modal-basic modal fade show pop7" id="breed_file" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-md" role="document">
            <div class="modal-content modal-bg-white">
                <div class="modal-header" style="border: none">
                    <h6 class="modal-title"><span class="titleType" th:text="${type}"></span> > 첨부파일</h6>
                    <span class="breed_title"></span>
                </div>
                <div class="modal-body">
                    <div class="form-group mb-0">
                        <button onclick="InsertFileBtn()">데이터 등록</button>
                    </div>
                    <div>
                        <div class="atbd-upload">
                            <table>
                                <thead>
                                <tr>
                                    <th>순번</th>
                                    <th>제목</th>
                                    <th>날짜</th>
                                </tr>
                                </thead>
                                <tbody id="file_list">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="modal-footer" style="border: none">
                    <button type="button" class="btn btn-secondary btn-sm" data-dismiss="modal">취소</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 첨부파일 등록창 -->
    <div class="modal-basic modal fade show pop1" id="insert_file" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-md" role="document">
            <div class="modal-content modal-bg-white " id="file_modal">
                <div class="modal-header" style="border: none">
                    <h6 class="modal-title"><span class="titleType" th:text="${type}"></span> > 첨부파일</h6>
                    <span class="breed_title"></span>
                </div>
                <form action="insertBreedFile" id="insertFile" method="POST" enctype="multipart/form-data">
                    <div class="modal-body">
                        <div class="form-group mb-0">
                            <span>제목</span>
                            <input type="text" class="form-control form-control-lg inputText file_title" name="breed_file_title">
                        </div>
                        <div class="form-group mb-0">
                            <textarea name="breed_file_contents" style="resize:none;"></textarea>
                        </div>
                        <div>
                            <div class="atbd-upload">
                                <div class="atbd-upload__button">
                                    <input type="file" id="upload_file" name="file">
                                </div>
                                <div class="atbd-upload__file">
                                    <ul>
                                        <li>
                                            <a href="" class="file-name">
                                                <i class="las la-paperclip"></i>
                                                <span class="name-text">xxx.png<span>
												</span></span>
                                            </a>
                                            <a href="" class="btn-delete">
                                                <i class="la la-trash"></i>
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer" style="border: none">
                        <input type="hidden" id="upload_id" name="breed_id">
                        <input type="hidden" id="file_type" name="file_type">
                        <input type="hidden" id="type" name="type" th:value="${type}">
                        <input type="hidden" id="resource" name="resource_id" th:value="${resource_id}">
                        <input type="hidden" id="crop_id" name="crop_id" th:value="${crop_id}">
                        <button type="button" class="btn btn-secondary btn-sm" onclick="dataToggle('#insert_file', '#breed_file')">취소</button>
                        <button type="button" class="btn btn-primary btn-sm" onclick="InsertFile()">저장</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 첨부파일 수정창 -->
    <div class="modal-basic modal fade show pop1" id="modify_file" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-md" role="document">
            <div class="modal-content modal-bg-white ">
                <div class="modal-header" style="border: none">
                    <h6 class="modal-title"><span class="titleType" th:text="${type}"></span> > 첨부파일</h6>
                    <span class="breed_title"></span>
                </div>
                <form action="updateBreedFile" id="modifyFile" method="POST" enctype="multipart/form-data">
                    <div class="modal-body">
                        <div class="form-group mb-0">
                            <span>제목</span>
                            <input type="text" class="form-control form-control-lg inputText" id="breed_file_title" name="breed_file_title">
                        </div>
                        <div class="form-group mb-0">
                            <div class="image-container">
                                <img id="preview-image">
                            </div>
                            <textarea id="breed_file_contents" name="breed_file_contents" style="resize:none;"></textarea>
                        </div>
                        <div>
                            <div class="atbd-upload">
                                <div class="atbd-upload__button">
                                    <a href="" class="btn btn-lg btn-outline-lighten btn-upload" id="file_download">
                                        <span data-feather="download"></span>
                                        <span id="uploads_origin_file"></span>
                                    </a>
                                    <input type="hidden" id="uploads_file" name="uploads_file">
                                    <input type="file" id="update_file" name="file">
                                </div>
                                <div class="atbd-upload__file">
                                    <ul>
                                        <li>
                                            <a href="" class="file-name">
                                                <i class="las la-paperclip"></i>
                                                <span class="name-text">xxx.png<span>
												</span></span>
                                            </a>
                                            <a href="" class="btn-delete"><i class="la la-trash"></i></a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer" style="border: none">
                        <input type="hidden" id="breed_file_id" name="breed_file_id">
                        <input type="hidden" id="type" name="type" th:value="${type}">
                        <input type="hidden" id="resource" name="resource_id" th:value="${resource_id}">
                        <input type="hidden" id="crop_id" name="crop_id" th:value="${crop_id}">
                        <button type="button" class="btn btn-secondary btn-sm" onclick="dataToggle('#modify_file', '#breed_file')">취소</button>
                        <button type="submit" class="btn btn-primary btn-sm" onclick="modifyFile()">수정</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 표시 헤더 선택 모달창 -->
    <div class="modal-basic modal fade show pop2" id="grid2" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-md" role="document">
            <form action="detail-display" method="POST" enctype="multipart/form-data">
                <div class="modal-content modal-bg-white">
                    <div class="modal-header" style="border: none">
                        <h6 class="modal-title" id="display_title"></h6>
                        <input type="hidden" id="resource_name_re" name="resource_name_re">
                        <input type="hidden" id="resource_id_re" name="resource_id_re">
                        <input type="hidden" id="crop_id_re" name="crop_id_re">
                    </div>
                    <div class="modal-body" style="-ms-user-select: none; -khtml-user-select: none; -webkit-user-select: none; user-select: none;">
                        <div class="tab-pane fade show active" id="control1" role="tabpanel" aria-labelledby="control1-tab">
                            <div class="tab-slide-content">
                                <div class="atbd-tab tab-horizontal">
                                    <!--<input type="hidden" id="detail_list1" name="detail_list">-->
                                    <div class="top_box">
                                        <ul class="nav nav-tabs vertical-tabs" role="tablist" id="headerList">
                                            <li class="nav-item active">
                                                <a class="nav-link" id="tab-horizontal-0-tab" data-toggle="tab" href="#tab-horizontal-0" role="tab" aria-controls="tab-horizontal-0"
                                                   aria-selected="true">기본 정보</a>
                                            </li>
                                            <li class="nav-item">
                                                <a class="nav-link" id="tab-horizontal-1-tab" data-toggle="tab" href="#tab-horizontal-1" role="tab" aria-controls="tab-horizontal-1"
                                                   aria-selected="false">특성 정보[종자원 기준]</a>
                                            </li>
                                            <li class="nav-item">
                                                <a class="nav-link" id="tab-horizontal-2-tab" data-toggle="tab" href="#tab-horizontal-2" role="tab" aria-controls="tab-horizontal-2"
                                                   aria-selected="false">특성 정보[사내 기준]</a>
                                            </li>
                                        </ul>
                                        <span class="prev"></span>
                                        <span class="next"></span>
                                    </div>
                                    <div class="tab-content">
                                        <div class="tab-pane fade show active" id="tab-horizontal-0" role="tabpanel" aria-labelledby="tab-horizontal-0-tab">
                                            <div class="content_1 clearfix">
                                                <div class="row mt-20">
                                                    <div class="col-lg-12">
                                                        <div class="card">
                                                            <div class="card-body">
                                                                <div class="row">
                                                                    <div class="col-lg-12">
                                                                        <span class="color-dark align-center" style="font-size: 16px;">표시항목 설정</span>
                                                                    </div>
                                                                </div>
                                                                <div class="row mt-4" style="justify-content: center; align-items: center;">
                                                                    <div class="col-lg-5" style="padding:0;">
                                                                        <ul class="display_list" id="step_container1"
                                                                            style="min-height: 500px; max-height: 500px; overflow-y: auto; border: 1px solid #D9D9D9">
                                                                        </ul>
                                                                    </div>
                                                                    
                                                                    <div class="box_content">
                                                                        <div class="box_center">
                                                                            
                                                                            <div class="buttonLi">
                                                                                <button type="button" onclick="MinusResearch(1);"><span ></span></button>
                                                                            </div>
                                                                            <div class="buttonLi">
                                                                                <button type="button" onclick="PlusResearch(1);"><span class="left_btn"></span></button>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-lg-5">
                                                                        <div class="row" style="overflow:auto; min-height: 500px; border: 1px solid #D9D9D9;">
                                                                            <div class="list-group mt-2" style="max-height: 500px; overflow-y: auto;">
                                                                                <ul class="detail_list" id="display_container1" name="기본 정보">
                                                                                </ul>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="tab-pane fade show" id="tab-horizontal-1" role="tabpanel" aria-labelledby="tab-horizontal-1-tab">
                                            <div class="content_1 clearfix">
                                                <div class="row mt-20">
                                                    <div class="col-lg-12">
                                                        <div class="card">
                                                            <div class="card-body">
                                                                <div class="row">
                                                                    <div class="col-lg-12">
                                                                        <span class="color-dark align-center" style="font-size: 16px;">표시항목 설정</span>
                                                                    </div>
                                                                </div>
                                                                <div class="row mt-4" style="justify-content: center;align-items: center;">
                                                                    <div class="col-lg-5" style="padding:0;">
                                                                        <ul class="display_list" id="step_container2"
                                                                            style="min-height: 500px; max-height: 500px; overflow-y: auto; border: 1px solid #D9D9D9">
                                                                        </ul>
                                                                    </div>
                                                                    <div class="box_content">
                                                                        <div class="box_center">
                                                                        	<div class="buttonLi">
                                                                                <button type="button" onclick="MinusResearch(2);"><span></span></button>
                                                                            </div>
                                                                            <div class="buttonLi">
                                                                                <button type="button" onclick="PlusResearch(2);"><span class="left_btn"></span></button>
                                                                            </div>
                                                                            
                                                                        </div>
                                                                    </div>
                                                                    
                                                                    <div class="col-lg-5">
                                                                        <div class="row" style="overflow:auto; min-height: 500px; border: 1px solid #D9D9D9;">
                                                                            <div class="list-group mt-2" style="max-height: 500px; orverfolw-y: auto;">
                                                                                <ul class="detail_list" id="display_container2" name="특성 정보(종자원 기준)">
                                                                                </ul>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="tab-pane fade show" id="tab-horizontal-2" role="tabpanel" aria-labelledby="tab-horizontal-2-tab">
                                            <div class="content_1 clearfix">
                                                <div class="row mt-20">
                                                    <div class="col-lg-12">
                                                        <div class="card">
                                                            <div class="card-body">
                                                                <div class="row">
                                                                    <div class="col-lg-12">
                                                                        <span class="color-dark align-center" style="font-size: 16px;">표시항목 설정</span>
                                                                    </div>
                                                                </div>
                                                                <div class="row mt-4" style="justify-content: center;align-items: center;">
                                                                    <div class="col-lg-5" style="padding:0;">
                                                                        <ul class="display_list" id="step_container3"
                                                                            style="min-height: 500px; max-height: 500px; overflow-y: auto; border: 1px solid #D9D9D9">
                                                                        </ul>
                                                                    </div>
                                                                    <div class="box_content">
                                                                        <div class="box_center">
                                                                            
                                                                            <div class="buttonLi">
                                                                                <button type="button" onclick="MinusResearch(3);"><span></span></button>
                                                                            </div>
                                                                            <div class="buttonLi">
                                                                                <button type="button" onclick="PlusResearch(3);"><span class="left_btn"></span></button>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    
                                                                    <div class="col-lg-5">
                                                                        <div class="row" style="overflow:auto; min-height: 500px; border: 1px solid #D9D9D9;">
                                                                            <div class="list-group mt-2" style="max-height: 500px; overflow-y: auto;">
                                                                                <ul class="detail_list" id="display_container3" name="특성 정보(사내 기준)">
                                                                                </ul>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer" style="border: none">
                        <button type="button" class="btn btn-secondary btn-sm" data-dismiss="modal">취소</button>
                        <button type="submit" class="btn btn-primary btn-sm">저장</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- 품종관리 데이터 목록 창 -->
    <div class="modal-basic modal fade show pop7" id="data_upload2" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-md" role="document">
            <div class="modal-content modal-bg-white ">
                <div class="modal-header" style="border: none">
                    <h6 class="modal-title"><span class="titleType" th:text="${type}"></span> > 데이터 등록</h6>
                </div>
                <div class="modal-body">
                    <div class="form-group mb-0">
                        <button onclick="dataToggle('#data_upload2', '#data_upload');">데이터 등록</button>
                        <button type="button" onclick="testbtn()">등록서식 다운로드</button>
                    </div>
                    <div>
                        <div class="atbd-upload">
                            <table>
                                <thead>
                                <tr>
                                    <th>순번</th>
                                    <th>등록일</th>
                                    <th>데이터수</th>
                                </tr>
                                </thead>
                                <tbody id="uploadDate">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="modal-footer" style="border: none">
                    <button type="button" class="btn btn-secondary btn-sm" data-dismiss="modal">취소</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 품종관리 데이터 등록 모달창 -->
    <div class="modal-basic modal fade show pop5" id="data_upload" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-md" role="document">
            <div class="modal-content modal-bg-white ">
                <div class="modal-header" style="border: none">
                    <h6 class="modal-title"><span class="titleType" th:text="${type}"></span> > 데이터 등록</h6>
                </div>
                <div class="modal-body">
                    <div class="form-group mb-0" style="justify-content:end">
                        <input type="file" id="excelFile" onchange="excelExport(event)" style="display: none"
                               accept="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel">
                        <button onclick="filesFunction()" class="btn btn-primary btn-sm">불러오기</button>
                        <input type="file" name="" id="file_data_upload" style="display: none;">
                    </div>
                    <div>
                        <form action="excelBreed" id="excelForm" method="POST" enctype="multipart/form-data">
                            <input type="hidden" id="excel_list" name="excel_list">
                            <div class="atbd-upload">
                                 <table id="excel_data">
                                    <thead><!--
                                    <th><span class="title">작물</span></th>
                                    <th><span class="title">시교명(ID)</span></th>
                                    <th><span class="title">품종명</span></th>
                                    <th><span class="title">모계 계통명(ID)</span></th>
                                    <th><span class="title">부계 계통명(ID)</span></th>
                                    <th><span class="title">생산판매 (신고번호)</span></th>
                                    <th><span class="title">생산판매 (신고일자)</span></th>
                                    <th><span class="title">보호출원 (출원번호)</span></th>
                                    <th><span class="title">보호출원 (출원일자)</span></th>
                                    <th><span class="title">보호등록 (등록번호)</span></th>
                                    <th><span class="title">보호등록 (등록일자)</span></th>
                                    <th><span class="title">미등록 (현지 상업화)</span></th>
                                    <th><span class="title">목표 시장</span></th>
                                    <th><span class="title">형태 구분1</span></th>
                                    <th><span class="title">형태 구분2</span></th>
                                    <th><span class="title">작물 타입1</span></th>
                                    <th><span class="title">작물 타입2</span></th>
                                    <th><span class="title">비고</span></th>
                                    </thead>-->
                                    <tbody>
                                    </tbody>
                                </table>  
                            </div>
                        </form>
                    </div>
                </div>
                <div class="modal-footer" style="border: none">
                    <button type="button" class="btn btn-secondary btn-sm" data-dismiss="modal" onclick="dataToggle('#data_upload', '#data_upload2');">취소</button>
                    <button type="button" class="btn btn-primary btn-sm" data-dismiss="modal" onclick="dataToggle('#data_upload', '#data_upload2'); InsertExcel();">등록</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 품종관리 데이터 확인 모달창 -->
    <div class="modal-basic modal fade show pop5" id="data_upload3" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-md" role="document">
            <div class="modal-content modal-bg-white ">
                <div class="modal-header" style="border: none">
                    <h6 class="modal-title"><span class="titleType" th:text="${type}"></span> > 데이터 등록</h6>
                </div>
                <div class="modal-body">
                    <div class="form-group mb-0" style="justify-content:end">
                        <input type="file" id="excelFile" onchange="excelExport(event)" style="display: none"
                               accept="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel">
                        <!--<button onclick="filesFunction()" class="btn btn-primary btn-sm">불러오기</button>-->
                        <input type="file" name="" id="file_data_upload" style="display: none;">
                    </div>
                    <div>
                        <form action="excelBreed" id="excelForm" method="POST" enctype="multipart/form-data">
                            <input type="hidden" id="excel_list" name="excel_list">
                            <div class="atbd-upload" id="file_grid">
                                <table id="excel_data">
                                    <thead id="breedHead">
                                    </thead>
                                    <tbody id="breedBody">
                                    </tbody>
                                </table>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="modal-footer" style="border: none">
                    <button type="button" class="btn btn-secondary btn-sm" data-dismiss="modal" onclick="dataToggle('#data_upload3', '#data_upload2');">취소</button>
                    <!--<button type="button" class="btn btn-primary btn-sm" data-dismiss="modal" onclick="dataToggle('#data_upload3', '#data_upload2'); InsertExcel();">등록</button>-->
                </div>
            </div>
        </div>
    </div>

    <!-- 등록정보 수정 모달창 -->
    <div class="modal-basic modal fade show pop6" id="grid3" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-md" role="document">
            <form action="updateAllBreed" id="updateAllForm" method="POST" enctype="multipart/form-data">
                <input type="hidden" id="breed_id" name="breed_id">
                <div class="modal-content modal-bg-white">
                    <div class="modal-header" style="border: none">
                        <h6 class="modal-title" id="display_title2"></h6>
                    </div>
                    <div class="modal-body">
                        <div class="tab-pane fade show active" id="control1" role="tabpanel" aria-labelledby="control1-tab">
                            <div class="tab-slide-content">
                                <div class="atbd-tab tab-horizontal">
                                    <div class="top_box">
                                        <ul class="nav nav-tabs vertical-tabs" role="tablist">
                                            <li class="nav-item">
                                                <a class="nav-link active" id="tab-horizontal-0-tab" data-toggle="tab" href="#tab-horizontal-0" role="tab"
                                                   aria-controls="tab-horizontal-0" aria-selected="true">기본 정보</a>
                                            </li>
                                            <li class="nav-item">
                                                <a class="nav-link active" id="tab-horizontal-1-tab" data-toggle="tab" href="#tab-horizontal-1" role="tab"
                                                   aria-controls="tab-horizontal-1" aria-selected="false">특성 정보[종자원 기준]</a>
                                            </li>
                                            <li class="nav-item">
                                                <a class="nav-link" id="tab-horizontal-2-tab" data-toggle="tab" href="#tab-horizontal-2" role="tab" aria-controls="tab-horizontal-2"
                                                   aria-selected="false">특성 정보[사내 기준]</a>
                                            </li>
                                        </ul>
                                        <span class="prev"></span>
                                        <span class="next"></span>
                                    </div>
                                    <input type="hidden" id="detail_list" name="detail_list">
                                    <div class="tab-content">
                                        <div class="tab-pane fade show active" id="tab-horizontal-0" role="tabpanel" aria-labelledby="tab-horizontal-0-tab">
                                            <div class="content_title clearfix">
                                                <ul>
                                                    <li>형질</li>
                                                    <li>조사값</li>
                                                </ul>
                                            </div>
                                            <div class="content_1 clearfix">
                                                <ul class="detail_list2" name="0">
                                                    <li>
                                                        <div class="input_text"><input type="text" name="breed_name"></div>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                        <div class="tab-pane fade" id="tab-horizontal-1" role="tabpanel" aria-labelledby="tab-horizontal-1-tab">
                                            <div class="content_title clearfix">
                                                <ul>
                                                    <li>형질</li>
                                                    <li>조사값</li>
                                                </ul>
                                            </div>
                                            <div class="content_1 clearfix">
                                                <ul class="detail_list2" name="2">
                                                </ul>
                                            </div>
                                        </div>
                                        <div class="tab-pane fade" id="tab-horizontal-2" role="tabpanel" aria-labelledby="tab-horizontal-2-tab">
                                            <div class="content_title clearfix">
                                                <ul>
                                                    <li>형질</li>
                                                    <li>조사값</li>
                                                </ul>
                                            </div>
                                            <div class="content_1 clearfix">
                                                <ul class="detail_list2" name="1">
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer" style="border: none">
                        <button type="button" class="btn btn-secondary btn-sm" data-dismiss="modal">취소</button>
                        <button type="button" class="btn btn-primary btn-sm" data-dismiss="modal" onclick="UpdateAllBtn();">저장</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- 연계 데이터 -->
    <div class="modal-basic modal fade show pop7" id="pop_data1" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-md" role="document">
            <div class="modal-content modal-bg-white">
                <div class="modal-header" style="border: none">
                    <h6 class="modal-title"><span class="titleType"></span></h6>
                    <span class="breed_title"></span>
                </div>
                <div class="modal-body">
                    <div class="bg-white">
                        <div id="selectGrid"></div>
                    </div>
                </div>
                <div class="modal-footer" style="border: none">
                    <button type="button" class="btn btn-secondary btn-sm" data-dismiss="modal">취소</button>
                </div>
            </div>
        </div>
    </div>

    <div class="load_wrap">
        <div class="load">
            <h2>잠시만 기다려주세요</h2>
            <div class="loader"></div>
        </div>
    </div>
</main>
<!-- 공통 하단 -->
<th:block th:include="/../fragments/footer.html"></th:block>
<!-- 공통 js -->
<th:block th:include="/../fragments/commonjs.html"></th:block>
<script type="text/javascript">
    /* data list controll */
    var leftList_one = [];
    var leftList_two = [];
    var leftList_three = [];

    var rightList_one = [];
    var rightList_two = [];
    var rightList_three = [];

    function testbtn() {
        
        
        console.log("thymeleaf test : [[${resource_id}]]");
        
        console.log("${type} ? : [[${type}]]");
        
        let crop_id = $("#CropSelect").val();
        let resource_name = $(".manage")[0].innerText;
        
        $.ajax(
                {
                    url: 'searchHeader',
                    method: 'POST',
                    dataType: 'json',
                    data: {"crop_id": crop_id, "resource_name": resource_name},
                    success: function (result) {
                    	
                    	
                    	var detail_arr = [];
                    	
                    	// '첨부파일' column이 남아있지만 차후에 올릴때부터는 없으므로 i=0부터
                    	for(var i=0 ; i<result.detail.length ; i++) {
                    		detail_arr.push(result.detail[i].detail_name);
                    	}
                    	
						var arr_of_arrs = [];
						
						arr_of_arrs.push(detail_arr);
                    	
						console.log(arr_of_arrs);
                    	
                    	//console.log("testbtn result : ", result);
                    	
                    	var excelHandler = {
        		
				        		getExcelFileName : function(){
				        		    return '[[${type}]].xlsx';
				        		},
				        		getSheetName : function(){
				        			return '[[${type}]]';
				        		},
				        		getExcelData : function(){
				        			return arr_of_arrs;
				        		},
				        		getWorksheet : function(){
				        			return XLSX.utils.aoa_to_sheet(this.getExcelData());
				        		}
				        }
						
                    	// step 1. workbook 생성
                        var wb = XLSX.utils.book_new();

                        // step 2. 시트 만들기 
                        var newWorksheet = excelHandler.getWorksheet();
                        
                        // step 3. workbook에 새로만든 워크시트에 이름을 주고 붙인다.  
                        XLSX.utils.book_append_sheet(wb, newWorksheet, excelHandler.getSheetName());

                        // step 4. 엑셀 파일 만들기 
                        var wbout = XLSX.write(wb, {bookType:'xlsx',  type: 'binary'});

                        // step 5. 엑셀 파일 내보내기 
                        saveAs(new Blob([s2ab(wbout)],{type:"application/octet-stream"}), excelHandler.getExcelFileName());
                    	
                    }
                    
    	});
        
         
        
        
        function s2ab(s) { 
            var buf = new ArrayBuffer(s.length); //convert s to arrayBuffer
            var view = new Uint8Array(buf);  //create uint8array as viewer
            for (var i=0; i<s.length; i++) view[i] = s.charCodeAt(i) & 0xFF; //convert to octet
            return buf;    
        }
        

        
        /*
        let title = $(".manage")[0].innerText;
        
        if (title == '파종대장') {
            location.href = '/excelTemplate/sowingSample.xlsx';
        } else if (title == '종자대장') {
            location.href = '/excelTemplate/seedSample.xlsx';
        } else if (title == '교배대장') {
            location.href = '/excelTemplate/matingSample.xlsx';
        }
        */
    }

    let c = 0;

    function dataToggle(one, two) {
        $(one).modal("hide");

        setTimeout(function () {
            $(two).modal("show");
        }, 5);
    }

    /* s : sessionStorage 저장 예제 */
    function setSessionS(key, value) {
        sessionStorage.setItem(key, value);
    }

    function getSessionS(key, useRemove) {
        let result = "";

        if (sessionStorage.getItem(key) !== null) {
            result = sessionStorage.getItem(key);
            if (useRemove) {
                removeSessionS(key);
            }
            return result;
        } else {
            result = $("#crop_id").val();
            return result;
        }
    }

    function removeSessionS(key) {
        sessionStorage.removeItem(key);
    }

    /* e : sessionStorage 저장 예제 */

    $(function () {

        $("#grid2 .top_box li").click(function () {
            $("#grid2 .content_1 li").each(function (i, e) {
                if ($(e).children().eq(0).is(":checked") == true) {
                    $(e).removeClass("checked");
                    $(e).children().eq(0).prop("checked", false);
                }
            })
        });
    })

    let topBox = document.getElementsByClassName("top_box");
    let navN = 0; //선택된 변수

    for (let k = 0; k < topBox.length; k++) {
        let [nav, prev, next] = topBox[k].children;
        let navLi = nav.children;

        let content = document.getElementsByClassName("tab-content")[k];
        let contentLi = content.children;

        navLi[navN].classList.add("active");

        for (let i = 0; i < navLi.length; i++) {
            navLi[i].idx = i;

            navLi[i].addEventListener("click", function (e) {
                navN = e.currentTarget.idx;
                moveFunction(navN);
            });
        }

        let list = navLi.length;

        next.addEventListener("click", function (e) {
            (navN < list - 1) ? navN += 1 : navN = list - 1;
            moveFunction(navN);
        });

        prev.addEventListener("click", function (e) {
            (navN > 0) ? navN -= 1 : navN = 0;
            moveFunction(navN);
        });

        function moveFunction(f) {
            let navMove = 0;
            for (let h = 0; h < navLi.length; h++) {
                navLi[h].classList.remove("active");
                contentLi[h].classList.remove("active");
            }


            let a = topBox[k].offsetWidth;
            let b = nav.offsetWidth;
            c = b - a;
            let d = c + 40 + "px";
            (f == 0) ? navMove += navLi[f].offsetLeft : navMove += navLi[f].offsetLeft - 50;

            if (navMove > c) {
                nav.style.marginLeft = "-" + d;
            } else {
                nav.style.marginLeft = "-" + navMove + "px";
            }

            navLi[f].classList.add("active");
            contentLi[f].classList.add("active");
            contentLi[f].classList.add("show");
        }
    }

    $('.inputText').bind('keydown', function (e) {
        if (e.keyCode == 13) {
            /* e.preventDefault(); */
            return false;
        }
    });

    function createList(list) { /* 리스트반환 */
        var add_list = "";
        if (list.length > 0) {
            for (var i = 0; i < list.length; i++) {
                var item = list[i];
                add_list += '<div data-id="' + item.detail_id + '" class="list-group step">';
                add_list += '<li class="list-group-item-sm list-group-item">';
                add_list += '<div class="">';
                add_list += '<input type="checkbox" class="checkbox mr-2" name="mis_research">';
                add_list += '<input type="hidden" name="detail_id" value="' + item.detail_id + '">';
                add_list += '<span class="research-title">' + item.detail_name + '</span>';
                add_list += '</div>';
                add_list += '</li>';
                add_list += '</div>';
            }
        }
        return add_list;
    }

    function createList1(list) {
        var add_list = "";
        if (list.length > 0) {
            for (var i = 0; i < list.length; i++) {
                var item = list[i];
                add_list += '<div data-id="' + item.detail_id + '" class="list-group step">';
                add_list += '<li class="list-group-item-sm list-group-item">';
                add_list += '<div class="">';
                add_list += '<input type="checkbox" class="checkbox mr-2" name="mis_research">';
                add_list += '<input type="hidden" name="detail_id_checked" value="' + item.detail_id + '">';
                add_list += '<span class="research-title">' + item.detail_name + '</span>';
                add_list += '</div>';
                add_list += '</li>';
                add_list += '</div>';
            }
        }
        return add_list;
    }

    // 표시항목 버튼
    function DisplayBtn() {
        leftList_one = [];
        leftList_two = [];
        leftList_three = [];

        rightList_one = [];
        rightList_two = [];
        rightList_three = [];
        $("#display_container1").empty();
        $("#display_container2").empty();
        $("#display_container3").empty();
        $("#step_container1").empty();
        $("#step_container2").empty();
        $("#step_container3").empty();
        var crop_id = $("#CropSelect").val();
        var resource_name = $(".manage")[0].innerText;

        var crop_text = $("#CropSelect option:selected").text();
        $("#display_title").text($(".titleType")[0].innerText + " > " + crop_text);
        $("#resource_name_re").val($(".titleType")[0].innerText);
        $("#crop_id_re").val(crop_id);
        $("#resource_id_re").val($('#resource_id').val());

        var data = {"crop_id": crop_id, "resource_name": resource_name}
        // ajax로 가져오기
        $.ajax(
            {
                url: 'detail-head',
                method: 'POST',
                dataType: 'json',
                resource_name,
                data: data,
                success: function (result) {
                    for (var i = 0; i < result.detailList.length; i++) {
                        var list = result.detailList[i];
                        var add_list = "";
                        var cData = {detail_id: list.detail_id, detail_name: list.detail_name};

                        if (list.detail_display === 0) {
                            if (list.detail_info == 0) {
                                leftList_one.push(cData);
                                $("#display_container1").html(createList1(leftList_one));
                            } else if (list.detail_info == 2) {
                                leftList_two.push(cData);
                                $("#display_container2").html(createList1(leftList_two));
                            } else if (list.detail_info == 1) {
                                leftList_three.push(cData);
                                $("#display_container3").html(createList1(leftList_three));
                            }
                        } else if (list.detail_display === 1) {
                            if (list.detail_info == 0) {
                                rightList_one.push(cData);
                                $("#step_container1").html(createList(rightList_one));
                            } else if (list.detail_info == 2) {
                                rightList_two.push(cData);
                                $("#step_container2").html(createList(rightList_two));
                            } else if (list.detail_info == 1) {
                                rightList_three.push(cData);
                                $("#step_container3").html(createList(rightList_three));
                            }
                        }
                    }

                    $("#grid2 .detail_list .list-group li").click(function (e) {
                        $(this).toggleClass("active");
                        if ($(this).hasClass("checked") == true) {
                            $(this).children().eq(0).prop("active", true);
                        } else {
                            $(this).children().eq(0).prop("active", false);
                        }
                    });

                    $("#grid2 .display_list .list-group li").click(function (e) {
                        $(this).toggleClass("active");
                        if ($(this).hasClass("checked") == true) {
                            $(this).children().eq(0).prop("active", true);
                        } else {
                            $(this).children().eq(0).prop("active", false);
                        }
                    });

                    // 붙여줌
                    //selectorCheck = document.querySelectorAll("input[type=checkbox][name=mis_research]");
                    selectorCheck = document.querySelectorAll(".detail_list li");
                    selectorCheck = Array.prototype.slice.call(selectorCheck);

                    selectorCheck2 = document.querySelectorAll(".display_list li");
                    selectorCheck2 = Array.prototype.slice.call(selectorCheck2);

                    window.addEventListener("keydown", onKeyWindow);
                    window.addEventListener("keyup", onKeyWindow);

                    for (var t = 0; t < selectorCheck.length; t++) {
                        selectorCheck[t].addEventListener("click", onSectionSelector);
                    }

                    for (var g = 0; g < selectorCheck2.length; g++) {
                        selectorCheck2[g].addEventListener("click", offSectionSelector);
                    }
                }
            });

        $("#grid2").modal("show");

    }

    // 특성상태 버튼
    let wideBreedId = 0;

    function EmptyBtn(e) {
        $("#display_title").text($(".titleType")[0].innerText + " > " + $("#CropSelect")[0].innerText);
        $("#display_name").val($("#CropSelect")[0].innerText);

        $("#breed_id").val(e);
        $("#grid3").modal("show");

        var data = {"breed_id": e};
        wideBreedId = e;

        $.ajax(
            {
                url: 'selectBreedStandard',
                method: 'POST',
                dataType: 'json',
                data: data,
                success: function (result) {
                    var empty_list = $(".empty_list");

                    for (var i = 0; i < empty_list.length; i++) {
                        empty_list.eq(i).val(result[i].standard_data);
                    }
                }
            });
    }

    /* s : input text 변경 이벤트 */
    let wideUpdateValue = [];

    function updateData(e) {
        let stan_value = e.value;
        let detail_id = e.name;
        let breed_id = wideBreedId;

        wideUpdateValue.push({"breed_id": breed_id, "detail_id": detail_id, "standard": stan_value});
    }

    /* s : 특성상태 데이터 수정 버튼 */
    function UpdateAllBtn() {
        $.ajax(
            {
                url: 'updateBreed',
                method: 'POST',
                dataType: 'json',
                data: {"data": JSON.stringify(wideUpdateValue)},
                success: function (result) {
                    if (result == 0) {
                        return Alert("수정에 실패하였습니다.")
                    } else {
                        location.reload();
                    }
                }
            });
    }

    /* e : 특성상태 데이터 수정 버튼 */

    $(".empty_list").change(function (e) {
        console.log("event : ", e);
    })
    /* e : input text 변경 이벤트 */

    let type = $("#title").text();
    let type_id = $("#title").text() + '_id';

    // DB에 저장된 데이터 출력
    $(document).ready(function () {
        // $("#CropSelect").val(getSessionS(type_id));			// 2022-06-07 | 최근방문한 작물 종류 저장(관리자원 삭제기능 도입시 문제가 생길것 같아 비활성화)
        
        console.log(type);

        
        SearchBreed(1);
        SearchBreedgrid(1);
    });

    // 작물 선택
    $("#CropSelect").change(function () {
        breedgrid.destroy();

        SearchBreed(1);
        SearchBreedgrid(1);
        setSessionS(type, $("#CropSelect option:selected").text());
        setSessionS(type_id, $("#CropSelect option:selected").val());
    })

    // 갯수 선택
    $("#limit").change(function () {
        breedgrid.destroy();

        SearchBreed(1);
        SearchBreedgrid(1);
    })

    // 품종 삭제
    function DeleteBreed() {
        var user_type = $("#user_type").val();

        if (user_type != 0) {
            return Alert("삭제 권한이 없습니다.");
        } else {
            var total_id = [];
            var breed_rows = [];

            var l = breedgrid.getCheckedRows().length;

            for (let i = 0; i < l; i++) {
                total_id.push(breedgrid.getCheckedRows()[i].breed_id);
                breed_rows.push(breedgrid.getCheckedRows()[i].breed_row);
            }

            var data = {'breed_id': total_id, 'breed_row': breed_rows};
            var formData = new FormData();
            formData.append("breed_id", total_id);
            formData.append("breed_row", breed_rows);
            if (confirm("삭제하시겠습니까?") == true) {
                $.ajax(
                    {
                        url: 'deleteBreed',
                        method: 'POST',
                        processData: false,
                        contentType: false,
                        data: formData,
                        success: function (result) {
                            if (result == 0) {
                                return Alert("삭제에 실패하였습니다.");
                            } else {
                                location.reload();
                            }
                        }
                    });
            } else {
                return false;
            }
        }
    }

    /* s : 구간 체크박스 선택 */
    var keyShiftBool = false;
    var selectorOnce = true;
    selectorCheck = "";
    selectorCheck = "";
    selectorCheck2 = "";
    selectorCheck2 = "";

    function onKeyWindow(e) {
        if (e.type === "keydown") {
            if (e.keyCode === 16 && selectorOnce) {
                keyShiftBool = true;
                selectorOnce = false;
            }
        } else if (e.type === "keyup") {
            keyShiftBool = false;
            selectorOnce = true;
        }
    }

    function onSectionSelector(e) {
        /* s : 액티브 탭 불러오기*/
        var tabList = document.querySelectorAll("#headerList li.nav-item");
        tabList = Array.prototype.slice.call(tabList);
        var activeTab = document.querySelector("#headerList li.nav-item.active");
        var indexTab = tabList.indexOf(activeTab);
        /* e : 액티브 탭 불러오기*/

        var getList = document.querySelectorAll("#display_container" + (indexTab + 1) + " li");
        getList = Array.prototype.slice.call(getList);
        var target = e.currentTarget;
        var index = getList.indexOf(target);

        if (keyShiftBool) {
            getList[index].classList.add("active");
            var checkedEls = document.querySelectorAll("#display_container" + (indexTab + 1) + " li.active");
            checkedEls = Array.prototype.slice.call(checkedEls);

            var firstIndex = getList.indexOf(checkedEls[0]);

            var lastIndex = getList.indexOf(checkedEls[checkedEls.length - 1]);

            let num = firstIndex;
            for (var i = 0; i < (Math.abs(lastIndex - firstIndex) + 1); i++) {
                if (getList[num].children[0] !== undefined) {
                    getList[num].children[0].checked = true;
                    getList[num].classList.add("active");
                }
                num++;
            }
        }
    }

    function offSectionSelector(e) {
        /* s : 액티브 탭 불러오기*/
        var tabList = document.querySelectorAll("#headerList li.nav-item");
        tabList = Array.prototype.slice.call(tabList);
        var activeTab = document.querySelector("#headerList li.nav-item.active");
        var indexTab = tabList.indexOf(activeTab);
        /* e : 액티브 탭 불러오기*/

        var getList = document.querySelectorAll("#step_container" + (indexTab + 1) + " li");
        getList = Array.prototype.slice.call(getList);

        var target = e.currentTarget;
        var index = getList.indexOf(target);

        if (keyShiftBool) {
            getList[index].classList.add("active");
            var checkedEls = document.querySelectorAll("#step_container" + (indexTab + 1) + " li.active");
            checkedEls = Array.prototype.slice.call(checkedEls);

            var firstIndex = getList.indexOf(checkedEls[0]);

            var lastIndex = getList.indexOf(checkedEls[checkedEls.length - 1]);

            let num = firstIndex;
            for (var i = 0; i < (Math.abs(lastIndex - firstIndex) + 1); i++) {
                if (getList[num].children[0] !== undefined) {
                    getList[num].children[0].children[0].checked = true;
                    getList[num].classList.add("active");
                }
                num++;
            }
        }
    }

    /* e : 구간 체크박스 선택 */

    /* 헤더 선택 */
    function PlusResearch(e) {
        var step_container = $("#step_container" + e);
        var display_container = $("#display_container" + e);
        var add_list = "";
        const left_container = document.querySelector('#display_container' + e);
        const right_container = document.querySelector('#step_container' + e);

        let all_list = left_container.querySelectorAll(".list-group-item-sm.list-group-item");
        all_list = Array.prototype.slice.call(all_list);
        let checked_list = left_container.querySelectorAll(".list-group-item-sm.list-group-item.active");
        checked_list = Array.prototype.slice.call(checked_list);

        var whichSelect = [];
        for (var i = 0; i < checked_list.length; i++) {
            var matchIndex = all_list.indexOf(checked_list[i]);
            if (e == 1) {
                whichSelect.push(leftList_one[matchIndex].detail_id);
            } else if (e == 2) {
                whichSelect.push(leftList_two[matchIndex].detail_id);
            } else if (e == 3) {
                whichSelect.push(leftList_three[matchIndex].detail_id);
            }

            if (e == 1) {
                rightList_one.push(leftList_one[matchIndex]);
            } else if (e == 2) {
                rightList_two.push(leftList_two[matchIndex]);
            } else if (e == 3) {
                rightList_three.push(leftList_three[matchIndex]);
            }
        }

        if (e == 1) {
            for (var i = 0; i < leftList_one.length; i++) {
                for (var t = 0; t < whichSelect.length; t++) {
                    if (leftList_one[i].detail_id === whichSelect[t]) {
                        leftList_one.splice(i, 1);
                    }
                }
            }
            rightList_one.sort((a, b) => a?.detail_id - b?.detail_id);
            display_container.html(createList1(leftList_one));
            step_container.html(createList(rightList_one));
        } else if (e == 2) {
            for (var i = 0; i < leftList_two.length; i++) {
                for (var t = 0; t < whichSelect.length; t++) {
                    if (leftList_two[i].detail_id === whichSelect[t]) {
                        leftList_two.splice(i, 1);
                    }

                }
            }
            rightList_two.sort((a, b) => a?.detail_id - b?.detail_id);
            display_container.html(createList1(leftList_two));
            step_container.html(createList(rightList_two));
        } else if (e == 3) {
            for (var i = 0; i < leftList_three.length; i++) {
                for (var t = 0; t < whichSelect.length; t++) {
                    if (leftList_three[i].detail_id === whichSelect[t]) {
                        leftList_three.splice(i, 1);
                    }

                }
            }
            rightList_three.sort((a, b) => a?.detail_id - b?.detail_id);
            display_container.html(createList1(leftList_three));
            step_container.html(createList(rightList_three));
        }

        CheckFunction();
    }

    //조사방법 체크박스 삭제
    function MinusResearch(e) {
        var step_container = $("#step_container" + e);
        var display_container = $("#display_container" + e);
        var add_list = "";
        const left_container = document.querySelector('#display_container' + e);
        const right_container = document.querySelector('#step_container' + e);

        // 체크 해제

        let all_list = right_container.querySelectorAll(".list-group-item-sm.list-group-item");
        all_list = Array.prototype.slice.call(all_list);
        let checked_list = right_container.querySelectorAll(".list-group-item-sm.list-group-item.active");
        checked_list = Array.prototype.slice.call(checked_list);

        var whichSelect = [];
        for (var i = 0; i < checked_list.length; i++) {
            var matchIndex = all_list.indexOf(checked_list[i]);
            if (e == 1) {
                whichSelect.push(rightList_one[matchIndex].detail_id);
            } else if (e == 2) {
                whichSelect.push(rightList_two[matchIndex].detail_id);
            } else if (e == 3) {
                whichSelect.push(rightList_three[matchIndex].detail_id);
            }

            if (e == 1) {
                leftList_one.push(rightList_one[matchIndex]);
            } else if (e == 2) {
                leftList_two.push(rightList_two[matchIndex]);
            } else if (e == 3) {
                leftList_three.push(rightList_three[matchIndex]);
            }
        }

        if (e == 1) {
            for (var i = 0; i < rightList_one.length; i++) {
                for (var t = 0; t < whichSelect.length; t++) {
                    if (rightList_one[i].detail_id === whichSelect[t]) {
                        rightList_one.splice(i, 1);
                    }
                }
            }
            leftList_one.sort((a, b) => a?.detail_id - b?.detail_id);
            display_container.html(createList1(leftList_one));
            step_container.html(createList(rightList_one));
        } else if (e == 2) {
            for (var i = 0; i < rightList_two.length; i++) {
                for (var t = 0; t < whichSelect.length; t++) {
                    if (rightList_two[i].detail_id === whichSelect[t]) {
                        rightList_two.splice(i, 1);
                    }
                }
            }
            leftList_two.sort((a, b) => a?.detail_id - b?.detail_id);
            display_container.html(createList1(leftList_two));
            step_container.html(createList(rightList_two));
        } else if (e == 3) {
            for (var i = 0; i < rightList_three.length; i++) {
                for (var t = 0; t < whichSelect.length; t++) {
                    if (rightList_three[i].detail_id === whichSelect[t]) {
                        rightList_three.splice(i, 1);
                    }
                }
            }
            leftList_three.sort((a, b) => a?.detail_id - b?.detail_id);
            display_container.html(createList1(leftList_three));
            step_container.html(createList(rightList_three));
        }

        CheckFunction();
    }

    // 통합 분석
    function AnalysisBtn() {
        let regExp = /<\/?[^>]+>/gi;

        let crop = $("#CropSelect option:selected").text();

        let total_id = [];

        let l = breedgrid.getCheckedRows().length;

        let chk = 0;

        for (let i = 0; i < l; i++) {
            let status = breedgrid.getCheckedRows()[i].status;
            let text = status.replace(regExp, "");

            if (text === "EMPTY") {
                chk = 1;
            }

            total_id.push(breedgrid.getCheckedRows()[i].breed_id)
        }

        if (total_id.length != 0) {
            if (chk === 1) {
                Alert1("형질 값이 존재하지 않습니다.")
            } else {
                window.open("/analysis?crop=" + crop + "&total_id=" + total_id + "&type=" + 1);
            }
        }
    }

    function FileBtn(e, type) {
        if (type == 'file') {
            $("#upload_id").val(e);
            $("#file_type").val(0);
            $("#breed_file").modal("show");

            var data = {"breed_id": e, "file_type": 0};

            $.ajax(
                {
                    url: 'selectBreedFile',
                    method: 'POST',
                    dataType: 'json',
                    data: data,
                    success: function (result) {
                        let file_list = $("#file_list");
                        let file_add = "";

                        for (let i = 0; i < result.breed_file.length; i++) {
                            let file = JSON.stringify(result.breed_file[i]);
                            let file_json = file.replace(/\"/g, "&quot;");

                            file_add += '<tr>';
                            file_add += '<td>' + (i + 1) + '</td>';
                            file_add += '<td><button onclick="ModifyBtn(' + result.breed_file[i].breed_file_id + ')" style="border:0px; color:blue; background: white;">' + result.breed_file[i].breed_file_title + '</button></td>';
                            file_add += '<td>' + result.breed_file[i].create_date + '</td>';
                            file_add += '<td><input type="hidden" id="file_' + result.breed_file[i].breed_file_id + '" value="' + file.replace(/\"/g, "&quot;") + '"></td>';
                            file_add += '</tr>';
                        }

                        file_list.empty();
                        file_list.append(file_add);
                    }
                });
        } else if (type == 'img') {
            $("#upload_id").val(e);
            $("#file_type").val(1);
            $("#breed_file").modal("show");

            var data = {"breed_id": e, "file_type": 1};

            $.ajax(
                {
                    url: 'selectBreedFile',
                    method: 'POST',
                    dataType: 'json',
                    data: data,
                    success: function (result) {
                        let file_list = $("#file_list");
                        let file_add = "";

                        for (let i = 0; i < result.breed_file.length; i++) {
                            let file = JSON.stringify(result.breed_file[i]);
                            let file_json = file.replace(/\"/g, "&quot;");

                            file_add += '<tr>';
                            file_add += '<td>' + (i + 1) + '</td>';
                            file_add += '<td><button onclick="ModifyBtn(' + result.breed_file[i].breed_file_id + ')" style="border:0px; color:blue; background: white;">' + result.breed_file[i].breed_file_title + '</button></td>';
                            file_add += '<td>' + result.breed_file[i].create_date + '</td>';
                            file_add += '<td><input type="hidden" id="file_' + result.breed_file[i].breed_file_id + '" value="' + file.replace(/\"/g, "&quot;") + '"></td>';
                            file_add += '</tr>';
                        }

                        file_list.empty();
                        file_list.append(file_add);
                    }
                });
        } else if (type == 'doc') {
            $("#upload_id").val(e);
            $("#file_type").val(2);
            $("#breed_file").modal("show");

            var data = {"breed_id": e, "file_type": 2};

            $.ajax(
                {
                    url: 'selectBreedFile',
                    method: 'POST',
                    dataType: 'json',
                    data: data,
                    success: function (result) {
                        let file_list = $("#file_list");
                        let file_add = "";

                        for (let i = 0; i < result.breed_file.length; i++) {
                            let file = JSON.stringify(result.breed_file[i]);
                            let file_json = file.replace(/\"/g, "&quot;");

                            file_add += '<tr>';
                            file_add += '<td>' + (i + 1) + '</td>';
                            file_add += '<td><button onclick="ModifyBtn(' + result.breed_file[i].breed_file_id + ')" style="border:0px; color:blue; background: white;">' + result.breed_file[i].breed_file_title + '</button></td>';
                            file_add += '<td>' + result.breed_file[i].create_date + '</td>';
                            file_add += '<td><input type="hidden" id="file_' + result.breed_file[i].breed_file_id + '" value="' + file.replace(/\"/g, "&quot;") + '"></td>';
                            file_add += '</tr>';
                        }

                        file_list.empty();
                        file_list.append(file_add);
                    }
                });
        }

    }

    function InsertFileBtn() {
        $("#breed_file").modal("hide");
        $("#insert_file").modal("show");
    }

    function InsertFile() {
        var file = $("#upload_file");
        var title = $(".file_title");

        if (file.val() == "") {
            Alert1("파일을 선택해주세요.");
        } else if (title.val() == "") {
            Alert1("제목을 입력하세요.");
        } else {
            $("#insertFile").submit();
        }
    }

    function modifyFile() {
        $("#modifyFile").submit();
    }

    function ModifyBtn(e) {
        var files = JSON.parse($("#file_" + e).val());

        $("#breed_file_id").val(files.breed_file_id);
        $("#breed_file_title").val(files.breed_file_title);
        $("#breed_file_contents").val(files.breed_file_contents);
        $("#uploads_origin_file").text(files.uploads_origin_file);
        $("#uploads_file").val(files.uploads_file);
        $("#file_download").attr("href", "/upload/" + files.uploads_file);
        $("#file_download").attr("download", "");

        let ele = $("#uploads_file").val(files.uploads_file)[0].defaultValue;

        imgView(ele);

        $("#breed_file").modal("hide");
        $("#modify_file").modal("show");
    }

    function CheckFunction() {
        // 박스안 리스트 클릭시 체크박스 체크
        $('#grid2 .tab-content li').off('click').on('click', function (e) {
            e.preventDefault();

            $(this).toggleClass("active");

            if ($(this).hasClass("active") == true) {
                $(this).find("input[type='checkbox']").eq(0).prop("checked", true);
            } else {
                $(this).find("input[type='checkbox']").eq(0).prop("checked", false);
            }
        });
    }

    /* s : 파종번호 모달창 */
    let selectgrid = [];
    //let selectgrid = null;

    function Search(e, v) {
        $("#pop_data1").modal();
        //$(".titleType").text("파종대장");
        $(".titleType").empty();

        let breed_id = e;
        let breed_detail_id = v;
        let crop_id = $("#CropSelect").val();
        let resource_name = $(".manage")[0].innerText;
        let limit = $("#limit").val();

        let data = {"breed_id": breed_id, "crop_id": crop_id, "resource_name": resource_name};
        //let data = {"breed_id": 407, "crop_id": 5, "resource_name": '무파종'}; 					// 무파종 모달창 출력

        console.log("data : ", data);
        
        /*
        $.ajax({
            url: "resource-list",
            method: "POST",
            dataType: "json",
            success: function (resource_list) {

                console.log('resource_list : ', resource_list);

                
                for(let k=0 ; k<resource_list.resourceList.length ; k++) {
                	console.log("k : ",k);
                	var grid_id = resource_list.resourceList.resource_name_id
                	$.ajax(
                            {
                                url: 'searchHeader',
                                method: 'POST',
                                dataType: 'json',
                                data: data,
                                success: function (result) {
                                	
                                	console.log('selectGrid'+k+1);
                                	
                                	console.log("searchHeader result : ", result);
                                	
                                	
                                    selectgrid[k] = new tui.Grid({
                                        el: document.getElementById('selectGrid'+k+1),
                                        scrollX: true,
                                        scrollY: false,
                                        data: [],
                                        editingEvent: 'click',
                                        columns: [],
                                        pageOptions: {
                                            useClient: true,
                                            perPage: limit
                                        }
                                    });

                                    const headerArr = [];

                                    let headerName = [];
                                    let colName = [];

                                    for (let i = 0; i < result.detail.length; i++) {
                                        let colHeader = result.detail[i].detail_name;
                                        colName[i] = result.detail[i].detail_id;

                                        headerName[colName[i]] = result.detail[i].detail_id;

                                        let filter = {type: 'text', showApplyBtn: true, showClearBtn: true};

                                        let arr = {}

                                        if (result.detail[i].detail_info == 1 || result.detail[i].detail_info == 2) {
                                            arr = {'header': colHeader, 'name': colName[i], 'editor': 'text', 'sortable': 'true', 'sortingType': 'asc', 'width': 500, 'filter': filter}
                                        } else if (result.detail[i].detail_info == 3) {
                                            if (result.detail[i].detail_type == 0) {
                                                arr = {'header': colHeader, 'name': 'img' + colName[i], 'width': 100, 'info': 'img'};
                                                headerName[colName[i]] = 'img' + colName[i];
                                            } else if (result.detail[i].detail_type == 1) {
                                                arr = {'header': colHeader, 'name': 'doc' + colName[i], 'width': 100, 'info': 'doc'};
                                                headerName[colName[i]] = 'doc' + colName[i];
                                            }
                                        } else if (result.detail[i].detail_info == 4) {
                                            continue;
                                        } else {
                                            arr = {'header': colHeader, 'name': colName[i], 'editor': 'text', 'sortable': 'true', 'sortingType': 'asc', 'width': 180, 'filter': filter}
                                        }

                                        headerArr.push(arr);
                                    }

                                    selectgrid[k].setColumns(headerArr);

                                    
                                    
                                }
                            });
                }
                
            }
        })
        */
        
        
        $.ajax(
            {
                url: 'searchHeader',
                method: 'POST',
                dataType: 'json',
                data: data,
                success: function (result) {
                	
                	console.log("searchHeader result : ", result);
                
                	// 2022-06-12 | cell과 연동되는 modal창의 title 출력
                	for(let i=0 ; i<result.detail.length ; i++) {
                		if(breed_detail_id == result.detail[i].detail_id) {
		                	$(".titleType").text(result.detail[i].detail_name);
                			break;
                		}
                	}
                	
                    selectgrid = new tui.Grid({
                        el: document.getElementById('selectGrid'),
                        scrollX: true,
                        scrollY: false,
                        data: [],
                        editingEvent: 'click',
                        columns: [],
                        pageOptions: {
                            useClient: true,
                            perPage: limit
                        }
                    });

                    const headerArr = [
                        {
                            'header': '첨부파일',
                            'name': 'file',
                            'width': 50,
                        },
                        {
                            'header': '특성상태',
                            'name': 'status',
                            'width': 150,
                        }
                    ];
                    
                    //const headerArr = [];

                    let headerName = [];
                    let colName = [];

                    for (let i = 0; i < result.detail.length; i++) {
                        let colHeader = result.detail[i].detail_name;
                        colName[i] = result.detail[i].detail_id;

                        headerName[colName[i]] = result.detail[i].detail_id;

                        let filter = {type: 'text', showApplyBtn: true, showClearBtn: true};

                        let arr = {}

                        if (result.detail[i].detail_info == 1 || result.detail[i].detail_info == 2) {
                        	arr = {'header': colHeader, 'name': colName[i], 'editor': 'text', 'sortable': 'true', 'sortingType': 'asc', 'width': 500, 'filter': filter};
                        } else if (result.detail[i].detail_info == 3) {
                            if (result.detail[i].detail_type == 0) {
                                arr = {'header': colHeader, 'name': 'img' + colName[i], 'width': 100, 'info': 'img'};
                                headerName[colName[i]] = 'img' + colName[i];
                            } else if (result.detail[i].detail_type == 1) {
                                arr = {'header': colHeader, 'name': 'doc' + colName[i], 'width': 100, 'info': 'doc'};
                                headerName[colName[i]] = 'doc' + colName[i];
                            }
                        } else if (result.detail[i].detail_info == 4) {
                            continue;
                        } /*else if (result.detail[i].detail_info == 5) {
                        	arr = {'header': colHeader, 'name': colName[i] + '_checked', 'editor': 'text', 'sortable': 'true', 'sortingType': 'asc', 'width': 500, 'filter': filter};
                        	headerName[colName[i]] = colName[i] + '_checked';
                        } */else {
                        	console.log("info==5");
                            arr = {'header': colHeader, 'name': colName[i], 'editor': 'text', 'sortable': 'true', 'sortingType': 'asc', 'width': 180, 'filter': filter}
                        }
                        
                        
//                        if (result.detail[i].detail_info == 1 || result.detail[i].detail_info == 2) {
//                            arr = {'header': colHeader, 'name': colName[i], 'editor': 'text', 'sortable': 'true', 'sortingType': 'asc', 'width': 500, 'filter': filter}
//                        } else if (result.detail[i].detail_info == 3) {
//                            if (result.detail[i].detail_type == 0) {
//                                arr = {'header': colHeader, 'name': 'img' + colName[i], 'width': 100, 'info': 'img'};
//                                headerName[colName[i]] = 'img' + colName[i];
//                            } else if (result.detail[i].detail_type == 1) {
//                                arr = {'header': colHeader, 'name': 'doc' + colName[i], 'width': 100, 'info': 'doc'};
//                                headerName[colName[i]] = 'doc' + colName[i];
//                            }
//                        } else if (result.detail[i].detail_info == 4) {
//                            continue;
//                        } else {
//                            arr = {'header': colHeader, 'name': colName[i], 'editor': 'text', 'sortable': 'true', 'sortingType': 'asc', 'width': 180, 'filter': filter}
//                        }
                        
                        
                        headerArr.push(arr);
                    }

                    console.log("headerArr : ", headerArr);
                    
                    selectgrid.setColumns(headerArr);
                    
                    
                }
            });
        
        
        
    }

    /* e : 파종번호 모달창 */

    /* s : 모달창 닫힐 때 이벤트 발생 */
    $(document).ready(function () {
        $('#pop_data1').on('hidden.bs.modal', function () {
            selectgrid.destroy();
        });
    });
    /* e : 모달창 닫힐 때 이벤트 발생 */

    let breedgrid = null;
    let updateBreedData = [];

    function SearchBreedgrid(e) {
        let crop_id = $("#CropSelect").val();
        let resource_name = $(".manage")[0].innerText;
        let limit = $("#limit").val();

        let data = {"crop_id": crop_id, "resource_name": resource_name};


        $.ajax(
            {
                url: 'searchHeader',
                method: 'POST',
                dataType: 'json',
                data: data,
                success: function (result) {
                    $("#resource_id").val(result.resource_id);
                    
                    console.log("breed result : ", result)
                    
                    breedgrid = new tui.Grid({
                        el: document.getElementById('breedGrid'),
                        scrollX: true,
                        scrollY: false,
                        data: result.breed,
                        //header: {align: 'left'},
                        rowHeaders: ['checkbox'],
                        columns: [],
                        pageOptions: {
                            useClient: true,
                            perPage: limit
                        },
                        
                        // 2022-06-02 | export 옵션
                        contextMenu: ({ rowKey, columnName }) => (
    							[
    								[
    									{
    										name: 'edit',
    										label: 'Edit',
    										action: () => {
    											breedgrid.startEditing(rowKey, columnName);
    										}
    									},
    									{
    										name: 'export',
    										label: 'Export',
    										subMenu:[
    											{
    												name: 'csvExport',
    												label: 'CSV Export',
    												action: () => {
    													breedgrid.export('csv', breedgridExportOption );
    												}
    											},
    											{
    												name: 'excelExport',
    												label: 'Excel export',
    												action: () => {
    													breedgrid.export('xlsx', breedgridExportOption);
    												}
    											}
    										]
    									}
    								]
    							]
    						)
    						
                        
                    });

                    const headerArr = [
                        {
                            'header': '첨부파일',
                            'name': 'file',
                            'width': 80,
                            'align': 'center'
                        },
                        {
                            'header': '특성상태',
                            'name': 'status',
                            'width': 120,
                            'align': 'center'
                        }
                    ];

                    let headerName = [];
                    let colName = [];

                    for (let i = 0; i < result.detail.length; i++) {
                        let colHeader = result.detail[i].detail_name;
                        
                        /*
                        let colHeader = "";
                        
                        if(result.detail[i].detail_name.includes('_checked')) {
                    		colHeader = result.detail[i].detail_name.replace('_checked','');
                    	} else {
	                        colHeader = result.detail[i].detail_name;
                    	}
                        */
                        
                        colName[i] = result.detail[i].detail_id;

                        headerName[colName[i]] = result.detail[i].detail_id;

                        let filter = {type: 'text', showApplyBtn: true, showClearBtn: true};

                        let arr = {}

                        if (result.detail[i].detail_info == 1 || result.detail[i].detail_info == 2) {
                        	arr = {'header': colHeader, 'name': colName[i], 'editor': 'text', 'sortable': 'true', 'sortingType': 'asc', 'width': 400, 'filter': filter,'align': 'center'};
                        } else if (result.detail[i].detail_info == 3) {
                            if (result.detail[i].detail_type == 0) {
                                arr = {'header': colHeader, 'name': 'img' + colName[i], 'width': 100, 'info': 'img'};
                                headerName[colName[i]] = 'img' + colName[i];
                            } else if (result.detail[i].detail_type == 1) {
                                arr = {'header': colHeader, 'name': 'doc' + colName[i], 'width': 100, 'info': 'doc'};
                                headerName[colName[i]] = 'doc' + colName[i];
                            }
                        } else if (result.detail[i].detail_info == 4) {
                            continue;
                        } else if (result.detail[i].detail_info == 5) {
                        	arr = {'header': colHeader, 'name': colName[i] + '_checked', 'editor': 'text', 'sortable': 'true', 'sortingType': 'asc', 'width': 400, 'filter': filter, 'align': 'center'};
                        	headerName[colName[i]] = colName[i] + '_checked';
                        } else {
                            arr = {'header': colHeader, 'name': colName[i], 'editor': 'text', 'sortable': 'true', 'sortingType': 'asc', 'width': 180, 'filter': filter, 'align': 'center'}
                        }

                        headerArr.push(arr);
                    }
                    
                    console.log("headerArr : ", headerArr);
                    
                 	// 2022-06-02 | export option 설정 //////////////////////////
                    let headerArrKeys = [];
                    for(let i=0 ; i<headerArr.length ; i++) {			
                    	if(isNaN(headerArr[i].name)) continue;
                    	headerArrKeys.push(headerArr[i].name);
                    }
                    console.log("headerArrKeys(=> colheader key)", headerArrKeys);
                    const breedgridExportOption = { fileName: $(".manage")[0].innerText ,
													columnNames: headerArrKeys }		
                    ////////////////////////////////////////////////////////////
                    

                    
                    breedgrid.setColumns(headerArr);

                    const dataList = [];

                    for (let i = 0; i < result.breed.length; i++) {
                        let data = result.breed[i].standardList;
                        let tempArray = {};

                        // console.log(data);
                        
                        tempArray['file'] = '<i class="bi bi-file-earmark-arrow-down"></i>';
                        tempArray['breed_id'] = result.breed[i].breed_id;

                        if (result.breed[i].detail_count == 0) {
                            tempArray['status'] = '<span style="color:red">EMPTY</span>';
                        } else {
                            tempArray['status'] = '<span style="color:blue">PROGRESS</span>';
                        }
                        
                        
                        for (let j = 1; j < headerName.length; j++) {
                            if ((typeof headerName[colName[j - 1]]) === 'string') {
                            	if(typeof Number(headerName[colName[j - 1]].replace('_checked','')) === 'number' ) {
                            		tempArray[headerName[colName[j - 1]]] = data[j - 1].standard_data;
                            	} else {
	                                tempArray[headerName[colName[j - 1]]] = '<i class="bi bi-file-earmark-arrow-down"></i>';
                            	}
                            } else if ((typeof headerName[colName[j - 1]]) === 'number') {
                                if (headerName[colName[j - 1]] == data[j - 1].detail_id) {
                                    tempArray[headerName[colName[j - 1]]] = data[j - 1].standard_data;
                                }
                            }
                        }
                        
                        /*
                        for (let j = 1; j < headerName.length; j++) {
                            if ((typeof headerName[colName[j - 1]]) === 'string') {
                                tempArray[headerName[colName[j - 1]]] = '<i class="bi bi-file-earmark-arrow-down"></i>';
                            } else if ((typeof headerName[colName[j - 1]]) === 'number') {
                                if (headerName[colName[j - 1]] == data[j - 1].detail_id) {
                                    tempArray[headerName[colName[j - 1]]] = data[j - 1].standard_data;
                                }
                            }
                        }
                        */

                        //console.log("tempArray : ", tempArray);
                        dataList.push(tempArray);
                    }

                    breedgrid.resetData(dataList);

                    breedgrid.on('editingStart', (ev) => {
                        if ($(".plus_btn_submit1")[0].style.display != 'block') {
                            $(".plus_btn_submit2").css("display", "block");
                        }
                    })

                    breedgrid.on('click', (ev) => {
                        let header;
                        let allCol = ev.instance.store.column.allColumns;
                        
                        console.log("ev : ", ev);

                        for (let i = 0; allCol.length; i++) {
                            if (allCol[i].name == ev.columnName) {
                                header = allCol[i].header
                                break;
                            }
                        }
                        
                        

                        if (ev.targetType === 'cell' && ev.columnName === 'file') {
                            let id = breedgrid.getRow(ev.rowKey).breed_id;

                            FileBtn(id, 'file');
                        } else if (ev.targetType === 'cell' && ev.columnName.includes('img')) {
                            let id = breedgrid.getRow(ev.rowKey).breed_id;

                            FileBtn(id, 'img');
                        } else if (ev.targetType === 'cell' && ev.columnName.includes('doc')) {
                            let id = breedgrid.getRow(ev.rowKey).breed_id;

                            FileBtn(id, 'doc');
                        } else if (ev.targetType === 'cell' && ev.columnName === 'status') {
                            let e_id = breedgrid.getRow(ev.rowKey).breed_id;

                            EmptyBtn(e_id);
                        } /* else if (ev.targetType === 'cell' && header === '파종번호') {
                            let breed_id = breedgrid.getRow(ev.rowKey).breed_id;

                            Search(breed_id);
                        } */
                        else if (ev.targetType === 'cell' && ev.columnName.includes('_checked')) {
                        	console.log("_checked 분류 성공. modal 구현중");
                        	
                        	let breed_id = breedgrid.getRow(ev.rowKey).breed_id;
                        	
                        	let breed_detail_id = ev.columnName.replace('_checked','');
                        	
                            Search(breed_id, breed_detail_id);
                        }
                    });

                    breedgrid.on('afterChange', (ev) => {
                        var user_type = $("#user_type").val();

                        if (user_type != 0 && user_type != 2) {
                            return Alert("수정 권한이 없습니다.");
                        } else {
                            for (let i = 0; i < ev.changes.length; i++) {
                                before = ev.changes[i].prevValue;
                                after = ev.changes[i].value;

                                if (after != before) {
                                    var breed_id = breedgrid.getRow(ev.changes[i].rowKey).breed_id;
                                    console.log(breed_id);
                                    // var detail_id = ev.changes[i].columnName;

                                    if(typeof ev.changes[i].columnName === 'number') {
                                    	var detail_id = ev.changes[i].columnName;
                                    } else {
                                    	var detail_id = ev.changes[i].columnName.replace('_checked','');
                                    }
                                    var standard = after;

                                    if (breed_id != null) {
                                        updateBreedData.push({"breed_id": breed_id, "detail_id": detail_id, "standard": standard});
                                    }
                                }

                                if ($(".plus_btn_submit1")[0].style.display != 'block') {
                                    $(".plus_btn_submit2").css("display", "block");
                                }
                            }
                        }
                    });
                }
            });
    }

    var lastID = 0;
    var saveStandard = [];
    let breedData = [];

    function insertRow() {
        var user_type = $("#user_type").val();

        if (user_type != 0 && user_type != 2) {
            return Alert("등록 권한이 없습니다.");
        } else {
            $(".plus_btn_submit1").css("display", "block");

            var cnt = breedgrid.getRowCount();

            const newRow = {'breed_id': null};

            breedgrid.prependRow(newRow);
            breedgrid.check(cnt);

            breedgrid.on('afterChange', (ev) => {
                for (let i = 0; i < ev.changes.length; i++) {
                    if (breedData.length != 0) {
                        let check = 0;

                        for (let j = 0; j < breedData.length; j++) {
                            if (breedData[j].detail_id == ev.changes[i].columnName) {
                                breedData[j].standard = ev.changes[i].value
                                check = 1;
                                break;
                            }
                        }

                        if (check == 0) {
                            breedData.push({"detail_id": ev.changes[i].columnName, "standard": ev.changes[i].value})
                        }
                    } else {
                        breedData.push({"detail_id": ev.changes[i].columnName, "standard": ev.changes[i].value})
                    }
                }
            });
            /**/
        }
    }

    function saveRow() {
        const sortBreed = [...breedData].sort((a, b) => a?.detail_id - b?.detail_id)

        let crop_id = $("#CropSelect").val();
        let resource_name = $(".manage")[0].innerText;

        let resource_id = $('#resource_id').val();
        let type_check = 0;
        let group = $('#user_group').val();

         $.ajax(
             {
                 url: 'insertBreed2',
                 method: 'POST',
                 dataType: 'json',
                 data: {
                     "data": JSON.stringify(sortBreed),
                     "resource_id": resource_id,
                     "crop_id": crop_id,
                     "resource_name": resource_name,
                     "type_check": type_check,
                     "user_group": group
                 },
                 success: function (result) {
                     if (result == 0) {
                         return Alert("저장에 실패하였습니다.");
                     } else {
                         window.location.href = "/breed?type=[[${type}]]&id=[[${resource_id}]]&crop_id=" + crop_id;
                         // location.reload();
                     }
                 }
             });
    }

    function cancelRow() {
        breedgrid.removeCheckedRows();

        $(".plus_btn_submit1").css("display", "none");
    }

    function updateRow() {
        $.ajax(
            {
                url: 'updateBreed',
                method: 'POST',
                dataType: 'json',
                data: {"data": JSON.stringify(updateBreedData)},
                success: function (result) {
                    if (result == 0) {
                        return Alert("수정에 실패하였습니다.")
                    } else {
                        location.reload();
                    }
                }
            });
    }

    function cancelUpdate() {
        $(".plus_btn_submit2").css("display", "none");

        if ($(".tui-grid-cell-content").hasClass("tui-grid-layer-editing")) {
            $(".tui-grid-cell-content").removeClass("tui-grid-layer-editing");
        }
    }

    /* 엑셀 업로드 목록창 */
    function filesFunction() {
        let filesBtn = document.getElementById("excelFile");
        var eventList = document.createEvent("MouseEvent");

        eventList.initEvent("click");
        filesBtn.dispatchEvent(eventList);
    }

    /* 엑셀 업로드 목록창 */

    /* 엑셀 코드 */
    function handleExcelDataAll(sheet) {
        handleExcelDataHtml(sheet); // html 형태
    }

    /* Html 형태로 출력 */
    function handleExcelDataHtml(sheet) {
        $("#displayExcelHtml").html(XLSX.utils.sheet_to_html(sheet));
    }

    function excelExport(event) {
        excelExportCommon(event, handleExcelDataAll);
    }

    function excelExportCommon(event, callback) {
        var input = event.target;
        var reader = new FileReader();

        reader.onload = function () {
            var fileData = reader.result;
            var wb = XLSX.read(fileData, {type: 'binary'});		
            var sheetNameList = wb.SheetNames; // 시트 이름 목록 가져오기
            var firstSheetName = sheetNameList[0]; // 첫번째 시트명
            var firstSheet = wb.Sheets[firstSheetName]; // 첫번째 시트
            callback(firstSheet);
            
            // delete firstSheet.A1;									
            var rowdata = XLSX.utils.sheet_to_json(firstSheet, {defval: ""});
            
            var keys = Object.keys(rowdata[0]);

            var html = "";

            html += "<thead class='text-center'>";
            html += "<tr>";
            
            $.each(rowdata[0], function (idx, key) {
                html += "<th><span class='excel-title'>" + idx + "</span></th>";
            })
            
            html += "</tr>";
            html += "</thead>";
            
            html += "<tbody class='text-center'>";
            html += "<tr class='excel_tr'>";
            
            for (var i = 0; i < rowdata.length; i++) {
                if (i === 0) {
                	
                	html += "<tbody class='text-center'>";
                    html += "<tr class='excel_tr'>";
                    
                     $.each(rowdata[0], function (idx, value) {
                         html += "<td class='excel'><span>" + value + "</span></td>";
                     })

                    
                } else if (i !== 0) {
                	
                	html += "<tbody class='text-center'>";
                    html += "<tr class='excel_tr'>";

                    var tmp = Object.keys(rowdata[0]);
                    var j = 0;

                    $.each(rowdata[i], function (idx, value) {
                        // 공백처리
                        if (idx == tmp[j]) {

                            html += "<td class='excel'><span>" + value + "</span></td>";
                            j++;

                        } else {
                            var idx_str = idx.replace(/[^0-9]/g, '');
                            var tmp_str = tmp[j].replace(/[^0-9]/g, '');

                            var gap = idx_str - tmp_str;

                            while (gap > 0) {
                                gap--;
                                html += "<td><span> </span></td>";
                            }

                            html += "<td class='excel'><span>" + value + "</span></td>";
                            j++;

                            j = idx_str;
                            j++;
                        }
                    });

                    html += "</tr>";
                    html += "</tbody>";
                }
            }
            
            /*
            
            var keys = Object.values(rowdata[0]);

            var html = "";

            for (var i = 0; i < rowdata.length; i++) {
                if (i === 0) {
                    html += "<thead class='text-center'>";
                    html += "<tr>";

                    $.each(rowdata[0], function (idx, value) {
                        html += "<th><span class='excel-title'>" + value + "</span></th>";
                    })

                    html += "</tr>";
                    html += "</thead>";
                } else if (i !== 0) {
                    html += "<tbody class='text-center'>";
                    html += "<tr class='excel_tr'>";

                    var tmp = Object.keys(rowdata[0]);
                    var j = 0;

                    $.each(rowdata[i], function (idx, value) {
                        // 공백처리
                        if (idx == tmp[j]) {

                            html += "<td class='excel'><span>" + value + "</span></td>";
                            j++;

                        } else {
                            var idx_str = idx.replace(/[^0-9]/g, '');
                            var tmp_str = tmp[j].replace(/[^0-9]/g, '');

                            var gap = idx_str - tmp_str;

                            while (gap > 0) {
                                gap--;
                                html += "<td><span> </span></td>";
                            }

                            html += "<td class='excel'><span>" + value + "</span></td>";
                            j++;

                            j = idx_str;
                            j++;
                        }
                    });

                    html += "</tr>";
                    html += "</tbody>";
                }
            }

            */
            
            var excel = [];

            for (var k = 1; k < rowdata.length; k++) {
                var chk = Object.values(rowdata[k]);

                for (var n = 0; n < keys.length; n++) {
                    if (chk[n] == undefined) {
                        excel[n] = {key: keys[n], value: " "};
                    } else if (keys[n] === "생산판매 (신고일자)") {
                        excel[n] = {key: keys[n], value: excelDateToJSDate(chk[n])};
                    } else if (keys[n] === "보호출원 (출원일자)") {
                        excel[n] = {key: keys[n], value: excelDateToJSDate(chk[n])};
                    } else if (keys[n] === "보호등록 (등록일자)") {
                        excel[n] = {key: keys[n], value: excelDateToJSDate(chk[n])};
                    } else {
                        excel[n] = {key: keys[n], value: "" + chk[n]};
                    }
                }
                const obj = {...excel};

                rowdata[k] = obj;
            }
            $("#excel_data").empty();
            $("#excel_data").append(html);
        };

        reader.readAsBinaryString(input.files[0]);
    }

    /* 엑셀 목록 창 */
    function openExcel() {
        var user_type = $("#user_type").val();

        if (user_type != 0 && user_type != 2) {
            return Alert("등록 권한이 없습니다.");
        } else {
            $("#data_upload2").modal();

            let resource_id = $('#resource_id').val();
            let resource_name = $(".manage")[0].innerText;

            let data = {"resource_id": resource_id, "resource_name": resource_name};

            console.log(data);

            $.ajax(
                {
                    url: 'selectBreedDateGroup',
                    method: 'POST',
                    dataType: 'json',
                    data: data,
                    success: function (result) {
                        var data_list = $("#uploadDate");
                        var data_add = "";

                        for (var i = result.dataGroup.length - 1; i > -1; i--) {
                            let date = result.dataGroup[i].datalist_date;

                            var resultArr = date.split('-');
                            var resultDate = "";

                            for (var j = 0; j < resultArr.length; j++) {
                                resultDate += resultArr[j];
                            }

                            data_add += '<tr>';
                            data_add += '<td>' + (i + 1) + '</td>';
                            data_add += '<td><button onclick="ModifyDataBtn(' + resultDate + ')" style="border:0px; color:blue; background: white;">' + result.dataGroup[i].datalist_date + '</button></td>';
                            data_add += '<td>' + result.dataGroup[i].cnt + '</td>';
                            data_add += '</tr>';
                        }

                        data_list.empty();
                        data_list.append(data_add);
                    }
                });

        }
    }

    /* 엑셀 확인 창 */
    function ModifyDataBtn(e) {
        let s = String(e);
        s = s.replace(/(\d{4})(\d{2})(\d{2})/g, '$1-$2-$3');
        let resource_id = $('#resource_id').val();
        let resource_name = $('#resource_name').val();

        var data = {"datalist_date": s, "resource_name": resource_name, "resource_id": resource_id};

        $("#data_upload2").modal("hide");
        $("#data_upload3").modal("show");

        $.ajax(
            {
                url: 'searchTargetBreed',
                method: 'POST',
                dataType: 'json',
                data: data,
                success: function (result) {
                    if (result != null) {

                        var header_list = $("#breedHead");
                        var header_add = "";
                        var breed_list = $("#breedBody");
                        var add_list = "";

                        let len = Object.keys(result.breed).length;

                        header_add += '<tr>';

                        for (var i = 0; i < result.detail.length; i++) {
                            header_add += '<th class="breedHead">' + result.detail[i].detail_name + '</th>'
                        }

                        header_add += '</tr>';

                        for (var i = 0; i < len; i++) {
                            add_list += '<tr>';

                            for (var j = 0; j < result.breed[i].length; j++) {
                                if (result.breed[i][j].standard_data != null) {
                                    add_list += '<td>' + result.breed[i][j].standard_data + '</td>';
                                } else {
                                    add_list += '<td></td>';
                                }
                            }

                            add_list += '</tr>';
                        }

                        header_list.empty();
                        header_list.append(header_add);

                        breed_list.empty();
                        breed_list.append(add_list);
                    }
                }
            }
        );
    }

    let now = null;

    /* 엑셀 입력 */
    function InsertExcel() {
        var crop_id = $("#CropSelect").val();
        var excel_list = $(".excel_tr");

        var total_arr = [];
        var excel_arr = [];
        for (var i = 0; i < excel_list.length; i++) {
            excel_arr = [];
            excel_arr.push(crop_id);

            var items = $(".excel_tr")[i].childNodes;

            for (var j = 0; j < items.length; j++) {
                excel_arr.push(items[j].innerText);
            }

            total_arr.push(excel_arr);
        }

        console.log("process? : ", total_arr);
        
        let resource_id = $('#resource_id').val();
        let type_check = 1;
        let group = $('#user_group').val();

        $("#excel_list").val(JSON.stringify(total_arr));

        $.ajax(
            {
                url: 'excelBreed',
                method: 'POST',
                dataType: 'json',
                data: {
                    "excel_list": JSON.stringify(total_arr),
                    "resource_id": resource_id,
                    "type_check": type_check,
                    "user_group": group
                },
                success: function (result) {

                    now = new Date(+new Date() + 3240 * 10000).toISOString().split("T")[0];

                    let listData = [];

                    let resource_name = $(".manage")[0].innerText;

                    let crop_id = $("#CropSelect").val();
                    let group = $('#user_group').val();

                    let lData = {"resource_name": resource_name, "datalist_date": now, "crop_id": crop_id, "user_group": group};

                    listData.push(lData);

                    $.ajax(
                        {
                            url: 'insertBreedDataList',
                            method: 'POST',
                            dataType: 'json',
                            data: {
                                "listData": JSON.stringify(listData)
                            },
                            success: function (result) {
                                location.reload();
                            }
                        })
                }
            }
        )
    }

    /* 엑셀 코드 */

    // table to json
    function tableToJson(table) {
        var data = [];

        var headers = [];
        for (var i = 0; i < table.rows[0].cells.length; i++) {
            headers[i] = table.rows[0].cells[i].innerText;
        }

        for (var i = 1; i < table.rows.length; i++) {
            var tableRow = table.rows[i];

            var rowData = {};

            for (var j = 0; j < tableRow.cells.length; j++) {
                rowData[headers[j]] = tableRow.cells[j].innerText;
            }

            data.push(rowData);
        }

        return data;
    }

    // table to json

    // date to string
    function excelDateToJSDate(excelDate) {
        var date = new Date(Math.round((excelDate - (25567 + 2)) * 86400 * 1000)),
            m = '' + (date.getMonth() + 1),
            d = '' + date.getDate(),
            y = date.getFullYear();

        if (m.length < 2) {
            m = '0' + m;
        }

        if (d.length < 2) {
            d = '0' + d;
        }

        return [y, m, d].join('-');
    }

    function imgView(e) {
        var fileForm = /(.*?)\.(jpg|jpeg|png|gif|bmp|pdf)$/;

        if (e.match(fileForm)) {
            document.getElementById("preview-image").src = '/upload/' + e;
        }
    }

    function changeSelect() {
        console.log(1);
    }

    /* s : 특성상태 표시 */
    function SearchBreed(e) {
        var crop_id = $("#CropSelect").val();
        var resource_name = $(".manage")[0].innerText;

        var data = {"crop_id": crop_id, "resource_name": resource_name}

        $.ajax(
            {
                url: 'detail-head',
                method: 'POST',
                dataType: 'json',
                data: data,
                success: function (result) {
                    var detail_list2 = $(".detail_list2");
                    var detail_add2 = "";

                    for (var i = 0; i < detail_list2.length; i++) {
                        detail_add2 = "";

                        for (var j = 0; j < result.detailList.length; j++) {

                            // 특성상태
                            if (result.detailList[j].detail_info == detail_list2.eq(i).attr("name")) {
                                detail_add2 += '<li>';
                                detail_add2 += '<div class="title">' + result.detailList[j].detail_name + '</div>';
                                detail_add2 += '<div class="input_text">';
                                detail_add2 += '<input type="text" class="empty_list" onchange="updateData(this)" name="' + result.detailList[j].detail_id + '">';
                                detail_add2 += '<input type="hidden" name="detail_id" value="' + result.detailList[j].detail_id + '"></div>';
                                detail_add2 += '</div>';
                                detail_add2 += '</li>';
                            }
                        }

                        detail_list2.eq(i).empty();
                        detail_list2.eq(i).append(detail_add2);
                    }

                    $("#offset").val(result.offset);
                    CheckFunction();
                }

            });
    }

    /* e : 특성상태 표시 */
</script>
</body>
</html>